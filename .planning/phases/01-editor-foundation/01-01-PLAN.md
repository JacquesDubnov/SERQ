---
phase: 01-editor-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src-tauri/
  - src/main.tsx
  - src/App.tsx
  - src/components/Editor/EditorCore.tsx
  - src/styles/editor.css
  - package.json
  - tailwind.config.js
autonomous: true

must_haves:
  truths:
    - "Tauri app launches and shows React frontend"
    - "TipTap editor renders and accepts text input"
    - "Editor has all critical performance configuration"
  artifacts:
    - path: "src/components/Editor/EditorCore.tsx"
      provides: "Singleton editor with critical config"
      contains: "shouldRerenderOnTransaction: false"
    - path: "src/main.tsx"
      provides: "React app entry point"
      exports: ["default"]
    - path: "src-tauri/src/main.rs"
      provides: "Tauri backend entry point"
  key_links:
    - from: "src/main.tsx"
      to: "src/App.tsx"
      via: "React render"
      pattern: "createRoot.*App"
    - from: "src/App.tsx"
      to: "src/components/Editor/EditorCore.tsx"
      via: "Component import"
      pattern: "import.*EditorCore"
---

<objective>
Establish the project foundation: Tauri 2 desktop app with React 19 frontend and TipTap 3 editor core configured with all critical performance patterns.

Purpose: This is the bedrock. Every subsequent plan depends on the editor existing and being correctly configured. The three critical patterns (single instance, no re-render avalanche, schema validation) must be correct from the start.

Output: Running Tauri app with TipTap editor that accepts text input without performance issues.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-editor-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tauri 2 + React 19 Project</name>
  <files>
    - /Users/jacquesdubnov/Coding/serq/src-tauri/
    - /Users/jacquesdubnov/Coding/serq/src/main.tsx
    - /Users/jacquesdubnov/Coding/serq/src/App.tsx
    - /Users/jacquesdubnov/Coding/serq/package.json
    - /Users/jacquesdubnov/Coding/serq/vite.config.ts
    - /Users/jacquesdubnov/Coding/serq/tsconfig.json
  </files>
  <action>
Create Tauri 2 project with React + TypeScript template:

```bash
cd /Users/jacquesdubnov/Coding/serq
npm create tauri-app@latest . -- --template react-ts --manager npm
```

If the directory isn't empty, init manually:
1. Create package.json with React 19, TypeScript, Vite 7
2. Run `npm create tauri-app@latest --init` to add Tauri scaffolding
3. Ensure Tauri CLI is 2.x (`@tauri-apps/cli@^2`)

After scaffold exists:
- Verify src/main.tsx renders App component
- Verify src-tauri/src/main.rs has standard Tauri boilerplate
- Run `npm install` to install dependencies

DO NOT modify the default Tauri permissions yet (that's Phase 2).
  </action>
  <verify>
```bash
cd /Users/jacquesdubnov/Coding/serq && npm run tauri dev
```
App window opens and shows default React content.
  </verify>
  <done>Tauri app launches, shows React frontend in native window.</done>
</task>

<task type="auto">
  <name>Task 2: Install TipTap Extensions</name>
  <files>
    - /Users/jacquesdubnov/Coding/serq/package.json
  </files>
  <action>
Install all TipTap packages needed for Phase 1:

```bash
cd /Users/jacquesdubnov/Coding/serq

# Core TipTap
npm install @tiptap/core @tiptap/pm @tiptap/react @tiptap/starter-kit

# Essential extensions for Phase 1
npm install @tiptap/extension-underline @tiptap/extension-link
npm install @tiptap/extension-highlight @tiptap/extension-text-align
npm install @tiptap/extension-text-style @tiptap/extension-color
npm install @tiptap/extension-placeholder @tiptap/extension-character-count
npm install @tiptap/extension-subscript @tiptap/extension-superscript

# State management
npm install zustand
```

Install Tailwind CSS if not already present:
```bash
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

Configure tailwind.config.js:
```javascript
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: { extend: {} },
  plugins: [],
}
```

Add Tailwind directives to src/index.css:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```
  </action>
  <verify>
```bash
cd /Users/jacquesdubnov/Coding/serq && npm ls @tiptap/core @tiptap/react zustand tailwindcss
```
All packages installed with correct versions (TipTap 3.x, Zustand 5.x, Tailwind 4.x).
  </verify>
  <done>TipTap 3.18.0+, Zustand 5.x, Tailwind CSS installed and configured.</done>
</task>

<task type="auto">
  <name>Task 3: Create EditorCore with Critical Configuration</name>
  <files>
    - /Users/jacquesdubnov/Coding/serq/src/components/Editor/EditorCore.tsx
    - /Users/jacquesdubnov/Coding/serq/src/styles/editor.css
    - /Users/jacquesdubnov/Coding/serq/src/App.tsx
  </files>
  <action>
Create the singleton editor component with ALL critical configuration from research:

**src/components/Editor/EditorCore.tsx:**
```typescript
import { useEditor, EditorContent } from '@tiptap/react'
import StarterKit from '@tiptap/starter-kit'
import Underline from '@tiptap/extension-underline'
import Link from '@tiptap/extension-link'
import Highlight from '@tiptap/extension-highlight'
import TextAlign from '@tiptap/extension-text-align'
import TextStyle from '@tiptap/extension-text-style'
import Color from '@tiptap/extension-color'
import Placeholder from '@tiptap/extension-placeholder'
import CharacterCount from '@tiptap/extension-character-count'
import Subscript from '@tiptap/extension-subscript'
import Superscript from '@tiptap/extension-superscript'
import { forwardRef, useImperativeHandle } from 'react'

export interface EditorCoreRef {
  setContent: (html: string) => void
  getHTML: () => string
  getJSON: () => unknown
  focus: () => void
  getEditor: () => ReturnType<typeof useEditor>
}

interface EditorCoreProps {
  initialContent?: string
  onUpdate?: (html: string) => void
  onSelectionChange?: () => void
}

export const EditorCore = forwardRef<EditorCoreRef, EditorCoreProps>(
  ({ initialContent = '<p></p>', onUpdate, onSelectionChange }, ref) => {
    const editor = useEditor({
      extensions: [
        StarterKit.configure({
          history: { depth: 100, newGroupDelay: 500 },
          // Gapcursor and Dropcursor included by default
        }),
        Underline,
        Link.configure({
          openOnClick: false,
          HTMLAttributes: { class: 'text-blue-600 underline cursor-pointer' },
        }),
        Highlight.configure({ multicolor: true }),
        TextAlign.configure({
          types: ['heading', 'paragraph'],
        }),
        TextStyle,
        Color,
        Placeholder.configure({
          placeholder: 'Start writing...',
        }),
        CharacterCount,
        Subscript,
        Superscript,
      ],
      content: initialContent,

      // CRITICAL: Performance configuration (from research)
      immediatelyRender: true, // Desktop app, not SSR
      shouldRerenderOnTransaction: false, // Prevent 60+ renders/second

      // CRITICAL: Schema validation (from research)
      enableContentCheck: true,
      onContentError: ({ error }) => {
        console.error('[EditorCore] Content validation failed:', error)
        // TODO: Wire to toast notification system in Phase 5
      },

      onUpdate: ({ editor }) => {
        onUpdate?.(editor.getHTML())
      },

      onSelectionUpdate: () => {
        onSelectionChange?.()
      },
    })

    // Expose methods for document operations (used by File menu in Phase 2)
    useImperativeHandle(ref, () => ({
      setContent: (html: string) => {
        editor?.commands.setContent(html, false, { preserveWhitespace: 'full' })
      },
      getHTML: () => editor?.getHTML() ?? '',
      getJSON: () => editor?.getJSON() ?? {},
      focus: () => editor?.commands.focus(),
      getEditor: () => editor,
    }), [editor])

    if (!editor) return null

    return (
      <EditorContent
        editor={editor}
        className="tiptap-editor prose prose-lg max-w-none focus:outline-none"
      />
    )
  }
)

EditorCore.displayName = 'EditorCore'
```

**src/styles/editor.css:**
```css
/* TipTap Editor Styles */

.tiptap-editor {
  min-height: 100%;
  padding: 2rem;
}

/* Placeholder */
.tiptap-editor p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  float: left;
  color: #adb5bd;
  pointer-events: none;
  height: 0;
}

/* Focus outline removal - we handle focus state differently */
.tiptap-editor:focus {
  outline: none;
}

/* Prose styling defaults */
.tiptap-editor h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-top: 2rem;
  margin-bottom: 1rem;
}

.tiptap-editor h2 {
  font-size: 2rem;
  font-weight: 600;
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
}

.tiptap-editor h3 {
  font-size: 1.5rem;
  font-weight: 600;
  margin-top: 1rem;
  margin-bottom: 0.5rem;
}

.tiptap-editor p {
  margin-bottom: 1em;
  line-height: 1.6;
}

.tiptap-editor ul,
.tiptap-editor ol {
  padding-left: 1.5rem;
  margin-bottom: 1em;
}

.tiptap-editor li {
  margin-bottom: 0.25em;
}

.tiptap-editor blockquote {
  border-left: 3px solid #e5e7eb;
  padding-left: 1rem;
  margin: 1rem 0;
  color: #6b7280;
  font-style: italic;
}

.tiptap-editor code {
  background-color: #f3f4f6;
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  font-family: ui-monospace, monospace;
  font-size: 0.875em;
}

.tiptap-editor pre {
  background-color: #1f2937;
  color: #f9fafb;
  padding: 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  margin: 1rem 0;
}

.tiptap-editor pre code {
  background: none;
  padding: 0;
  color: inherit;
}

/* Gapcursor styling */
.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
}

.ProseMirror-gapcursor:after {
  content: '';
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}
```

**Update src/App.tsx to use EditorCore:**
```typescript
import { useRef } from 'react'
import { EditorCore, EditorCoreRef } from './components/Editor/EditorCore'
import './styles/editor.css'

function App() {
  const editorRef = useRef<EditorCoreRef>(null)

  return (
    <div className="min-h-screen bg-white">
      <main className="max-w-4xl mx-auto py-8">
        <EditorCore
          ref={editorRef}
          initialContent="<p>Start writing your document...</p>"
          onUpdate={(html) => {
            // Will wire to dirty state in Plan 04
            console.log('Content updated:', html.length, 'chars')
          }}
        />
      </main>
    </div>
  )
}

export default App
```

Ensure src/index.css imports editor.css and Tailwind.
  </action>
  <verify>
```bash
cd /Users/jacquesdubnov/Coding/serq && npm run tauri dev
```
1. App launches
2. Editor shows placeholder text "Start writing..."
3. Can type text and see it appear
4. No console errors about content validation
5. Check React DevTools - EditorCore should NOT re-render on every keystroke
  </verify>
  <done>
EditorCore exists with:
- shouldRerenderOnTransaction: false
- enableContentCheck: true with error handler
- All Phase 1 extensions loaded
- Ref exposes setContent/getHTML/focus methods
- Basic prose styling applied
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build check:**
```bash
cd /Users/jacquesdubnov/Coding/serq && npm run build && npm run tauri build -- --debug
```
Both frontend and Tauri build should succeed.

2. **Runtime check:**
- App window opens
- Editor is visible and accepts input
- Text appears as you type without lag
- Console shows no errors

3. **Critical config check:**
Open React DevTools Profiler, type rapidly - EditorCore component should NOT show constant re-renders.
</verification>

<success_criteria>
- Tauri 2.x app runs on macOS
- TipTap 3.18.0+ editor renders
- All extensions from research installed
- Critical performance config verified in code:
  - `shouldRerenderOnTransaction: false`
  - `enableContentCheck: true`
  - `immediatelyRender: true`
- EditorCore ref exposes setContent, getHTML, getJSON, focus, getEditor
</success_criteria>

<output>
After completion, create `.planning/phases/01-editor-foundation/01-01-SUMMARY.md`
</output>
