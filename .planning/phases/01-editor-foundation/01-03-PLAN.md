---
phase: 01-editor-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/Layout/Canvas.tsx
  - src/components/Editor/EditorWrapper.tsx
  - src/styles/editor.css
autonomous: true

must_haves:
  truths:
    - "User can click empty space below content and cursor appears there"
    - "Editor content is centered with max-width constraint"
    - "Content reflows when window is resized"
    - "Canvas has adjustable width (narrow/normal/wide/full)"
  artifacts:
    - path: "src/components/Editor/EditorWrapper.tsx"
      provides: "Click-anywhere cursor placement"
      contains: "handleWrapperClick"
    - path: "src/components/Layout/Canvas.tsx"
      provides: "Responsive canvas container"
      contains: "canvas-width"
    - path: "src/styles/editor.css"
      provides: "Canvas width CSS variables"
      contains: "--canvas-width"
  key_links:
    - from: "src/components/Editor/EditorWrapper.tsx"
      to: "EditorCore"
      via: "Wraps children and handles empty space clicks"
      pattern: "editor\\.commands\\.focus"
    - from: "src/components/Layout/Canvas.tsx"
      to: "CSS variables"
      via: "data-canvas-width attribute"
      pattern: "data-canvas-width"
---

<objective>
Create the responsive canvas layout with click-anywhere cursor placement, fulfilling the continuous flow canvas requirements (FOUND-01 through FOUND-05).

Purpose: The canvas is the writing surface. It must feel infinite (continuous scroll), responsive (adapts to screen), and forgiving (click anywhere, cursor appears). This differentiates SERQ from paginated editors.

Output: EditorWrapper handles click-anywhere, Canvas provides responsive container with adjustable widths.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-editor-foundation/01-RESEARCH.md
@.planning/phases/01-editor-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EditorWrapper with Click-Anywhere Handling</name>
  <files>
    - /Users/jacquesdubnov/Coding/serq/src/components/Editor/EditorWrapper.tsx
  </files>
  <action>
Create the wrapper component that handles clicks in empty space below content:

**src/components/Editor/EditorWrapper.tsx:**
```typescript
import { useRef, useCallback, ReactNode } from 'react'
import { Editor } from '@tiptap/core'

interface EditorWrapperProps {
  editor: Editor | null
  children: ReactNode
  className?: string
}

export function EditorWrapper({ editor, children, className = '' }: EditorWrapperProps) {
  const wrapperRef = useRef<HTMLDivElement>(null)

  const handleWrapperClick = useCallback((e: React.MouseEvent<HTMLDivElement>) => {
    if (!editor || !wrapperRef.current) return

    // Only handle direct clicks on the wrapper, not clicks on content
    // This catches clicks in the empty space below/around the editor content
    if (e.target !== wrapperRef.current) return

    // Get the editor's DOM element
    const editorElement = wrapperRef.current.querySelector('.tiptap-editor')
    if (!editorElement) return

    // Get click position relative to wrapper
    const wrapperRect = wrapperRef.current.getBoundingClientRect()
    const clickY = e.clientY - wrapperRect.top

    // Get content height
    const contentHeight = editorElement.scrollHeight

    // If click is below content, move cursor to end and potentially add paragraph
    if (clickY > contentHeight) {
      // Focus at end of document
      editor.commands.focus('end')

      // Check if last node is empty paragraph - if not, create one
      const { doc } = editor.state
      const lastNode = doc.lastChild
      const isEmpty = lastNode?.type.name === 'paragraph' &&
                     lastNode.content.size === 0

      if (!isEmpty) {
        // Add new paragraph at end
        editor.chain()
          .focus('end')
          .createParagraphNear()
          .focus('end')
          .run()
      }
    } else {
      // Click is within content area but not on content itself
      // (e.g., in the margin area) - just focus the editor
      editor.commands.focus()
    }
  }, [editor])

  return (
    <div
      ref={wrapperRef}
      onClick={handleWrapperClick}
      className={`editor-wrapper min-h-screen cursor-text ${className}`}
    >
      {children}
    </div>
  )
}
```

Key behaviors:
1. Click empty space below content → cursor goes to end, new paragraph created if needed
2. Click within margin area → editor receives focus
3. Click on actual content → normal TipTap behavior (event not intercepted)
4. cursor-text class shows text cursor in empty areas, signaling "you can type here"
  </action>
  <verify>
```bash
cd /Users/jacquesdubnov/Coding/serq && npm run build
```
TypeScript compiles without errors.
  </verify>
  <done>EditorWrapper component handles click-anywhere with focus and paragraph creation.</done>
</task>

<task type="auto">
  <name>Task 2: Create Responsive Canvas with Width Controls</name>
  <files>
    - /Users/jacquesdubnov/Coding/serq/src/components/Layout/Canvas.tsx
    - /Users/jacquesdubnov/Coding/serq/src/styles/editor.css
  </files>
  <action>
Create the Canvas component and update CSS for responsive widths:

**src/components/Layout/Canvas.tsx:**
```typescript
import { ReactNode } from 'react'

export type CanvasWidth = 'narrow' | 'normal' | 'wide' | 'full'

interface CanvasProps {
  children: ReactNode
  width?: CanvasWidth
  className?: string
}

// Width values for each setting
const widthClasses: Record<CanvasWidth, string> = {
  narrow: 'max-w-xl',    // 576px
  normal: 'max-w-3xl',   // 768px
  wide: 'max-w-5xl',     // 1024px
  full: 'max-w-none',    // No constraint
}

export function Canvas({ children, width = 'normal', className = '' }: CanvasProps) {
  return (
    <div
      className={`canvas-container min-h-screen bg-white ${className}`}
      data-canvas-width={width}
    >
      <div className={`canvas-content mx-auto px-8 py-12 ${widthClasses[width]}`}>
        {children}
      </div>
    </div>
  )
}
```

**Update src/styles/editor.css - add canvas styles:**
```css
/* Canvas width CSS custom properties for theme system (Phase 3) */
:root {
  --canvas-width-narrow: 576px;
  --canvas-width-normal: 768px;
  --canvas-width-wide: 1024px;
  --canvas-width-full: 100%;
}

/* Responsive canvas container */
.canvas-container {
  /* Continuous flow - no pagination */
  overflow-y: auto;
  overflow-x: hidden;
}

/* Canvas content area */
.canvas-content {
  /* Ensure content doesn't touch edges on mobile */
  padding-left: max(1rem, env(safe-area-inset-left, 1rem));
  padding-right: max(1rem, env(safe-area-inset-right, 1rem));
}

/* Editor wrapper for click-anywhere */
.editor-wrapper {
  /* Minimum height ensures there's always space to click below content */
  min-height: calc(100vh - 4rem); /* Account for toolbar height */

  /* Visual feedback that empty space is clickable */
  cursor: text;
}

/* When editor has content, remove cursor from wrapper where content exists */
.editor-wrapper .tiptap-editor {
  cursor: auto;
}

/* Responsive adjustments */
@media (max-width: 640px) {
  .canvas-content {
    padding-left: 1rem;
    padding-right: 1rem;
  }

  .tiptap-editor h1 {
    font-size: 2rem;
  }

  .tiptap-editor h2 {
    font-size: 1.5rem;
  }
}

/* Print styles - optional pagination for physical output */
@media print {
  .canvas-container {
    overflow: visible;
  }

  .tiptap-editor {
    page-break-inside: auto;
  }

  .tiptap-editor h1,
  .tiptap-editor h2,
  .tiptap-editor h3 {
    page-break-after: avoid;
  }

  .tiptap-editor p {
    orphans: 3;
    widows: 3;
  }
}
```

The CSS custom properties (--canvas-width-*) will be used by the style system in Phase 3 for theme-based width control. For now, Tailwind classes handle the actual sizing.
  </action>
  <verify>
```bash
cd /Users/jacquesdubnov/Coding/serq && npm run build
```
Build succeeds, no CSS parsing errors.
  </verify>
  <done>Canvas component with width prop (narrow/normal/wide/full), responsive CSS, print styles.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate Canvas and Wrapper in App</name>
  <files>
    - /Users/jacquesdubnov/Coding/serq/src/App.tsx
  </files>
  <action>
Update App.tsx to use the new Canvas and EditorWrapper components:

**src/App.tsx:**
```typescript
import { useRef, useState, useEffect } from 'react'
import { EditorCore, EditorCoreRef } from './components/Editor/EditorCore'
import { EditorToolbar } from './components/Editor/EditorToolbar'
import { EditorWrapper } from './components/Editor/EditorWrapper'
import { Canvas, CanvasWidth } from './components/Layout/Canvas'
import { Editor } from '@tiptap/core'
import './styles/editor.css'

function App() {
  const editorRef = useRef<EditorCoreRef>(null)
  const [editor, setEditor] = useState<Editor | null>(null)
  const [canvasWidth, setCanvasWidth] = useState<CanvasWidth>('normal')

  // Get editor instance after mount
  useEffect(() => {
    const timer = setTimeout(() => {
      const editorInstance = editorRef.current?.getEditor()
      if (editorInstance) {
        setEditor(editorInstance)
      }
    }, 0)
    return () => clearTimeout(timer)
  }, [])

  return (
    <div className="min-h-screen bg-gray-100 flex flex-col">
      {/* Toolbar */}
      {editor && (
        <div className="bg-white border-b border-gray-200 sticky top-0 z-20">
          <div className="flex items-center justify-between">
            <EditorToolbar editor={editor} />

            {/* Canvas width control - temporary UI, will move to settings panel in Phase 5 */}
            <div className="flex items-center gap-2 px-4 py-2 border-l border-gray-200">
              <span className="text-xs text-gray-500">Width:</span>
              <select
                value={canvasWidth}
                onChange={(e) => setCanvasWidth(e.target.value as CanvasWidth)}
                className="text-xs border border-gray-200 rounded px-2 py-1"
              >
                <option value="narrow">Narrow</option>
                <option value="normal">Normal</option>
                <option value="wide">Wide</option>
                <option value="full">Full</option>
              </select>
            </div>
          </div>
        </div>
      )}

      {/* Canvas with responsive container */}
      <Canvas width={canvasWidth}>
        <EditorWrapper editor={editor}>
          <EditorCore
            ref={editorRef}
            initialContent="<p>Start writing your document...</p>"
            onUpdate={(html) => {
              console.log('Content updated:', html.length, 'chars')
            }}
          />
        </EditorWrapper>
      </Canvas>
    </div>
  )
}

export default App
```

Key integration points:
1. Canvas wraps everything for responsive width control
2. EditorWrapper wraps EditorCore for click-anywhere
3. Canvas width selector in toolbar (temporary - moves to settings in Phase 5)
4. Editor instance passed to EditorWrapper for click handling
  </action>
  <verify>
```bash
cd /Users/jacquesdubnov/Coding/serq && npm run tauri dev
```
1. App launches with editor in centered canvas
2. Change width dropdown: content width changes (narrow smaller, wide bigger, full stretches)
3. Click in empty gray area below content: cursor moves to end, new paragraph appears if needed
4. Resize window: content reflows, doesn't break layout
5. Click-anywhere works in the white canvas area below the text
  </verify>
  <done>
App integrates Canvas and EditorWrapper with:
- Responsive canvas with width selector
- Click-anywhere cursor placement working
- Content reflows on window resize
- Clean visual hierarchy (toolbar → canvas → editor)
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Click-anywhere test:**
- Write several lines of text
- Click far below the last line (in empty white space)
- Cursor should appear at end, new paragraph created if last paragraph wasn't empty
- Click in the gray area outside the canvas - nothing happens (correct)

2. **Responsive test:**
- Set width to "narrow" - content becomes narrower
- Set width to "full" - content stretches to fill window
- Resize browser window at each setting - content reflows smoothly

3. **Continuous flow test:**
- Add lots of content (20+ paragraphs)
- Scroll - content scrolls smoothly, no page breaks
- Click-anywhere still works at any scroll position

4. **Mobile simulation:**
- Use browser dev tools to simulate narrow viewport
- Content should have appropriate padding, text should reflow
</verification>

<success_criteria>
- Click anywhere in empty canvas space places cursor there
- Canvas width is adjustable via dropdown (narrow/normal/wide/full)
- Content reflows when window is resized
- No horizontal scroll at any width setting
- Continuous scroll, no pagination
- Clean visual appearance (white canvas on light gray background)
</success_criteria>

<output>
After completion, create `.planning/phases/01-editor-foundation/01-03-SUMMARY.md`
</output>
