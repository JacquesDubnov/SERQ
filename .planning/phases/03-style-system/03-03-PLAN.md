---
phase: 03-style-system
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/StylePanel/StylePanel.tsx
  - src/components/StylePanel/PresetSection.tsx
  - src/components/StylePanel/PresetButton.tsx
  - src/components/StylePanel/index.ts
  - src/hooks/useFormatPainter.ts
  - src/components/FormatPainter/FormatPainter.tsx
  - src/components/FormatPainter/index.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "Style panel slides in from right and pushes content"
    - "Clicking a preset instantly updates the document"
    - "Accordion sections expand one at a time"
    - "Format painter copies formatting from source selection"
    - "Format painter applies formatting to target selection"
    - "Format painter has toggle mode and hold mode"
  artifacts:
    - path: "src/components/StylePanel/StylePanel.tsx"
      provides: "Main slide-in panel component"
      exports: ["StylePanel"]
    - path: "src/hooks/useFormatPainter.ts"
      provides: "Format painter logic hook"
      exports: ["useFormatPainter"]
    - path: "src/components/FormatPainter/FormatPainter.tsx"
      provides: "Format painter toolbar button"
      exports: ["FormatPainter"]
  key_links:
    - from: "src/components/StylePanel/StylePanel.tsx"
      to: "src/stores/styleStore.ts"
      via: "useStyleStore hook"
      pattern: "useStyleStore"
    - from: "src/hooks/useFormatPainter.ts"
      to: "src/stores/styleStore.ts"
      via: "format painter state"
      pattern: "formatPainter|captureFormat|applyFormat"
---

<objective>
Build the Style Panel UI and Format Painter functionality.

Purpose: Users need a visual interface to browse and apply presets. The style panel slides in from the right with accordion sections for Typography, Colors, and Canvas. Format painter lets users copy formatting between selections.

Output: Working style panel component, working format painter with toggle/hold modes
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03-style-system/03-CONTEXT.md
@.planning/phases/03-style-system/03-02-SUMMARY.md
@src/stores/styleStore.ts
@src/lib/presets.ts
@src/components/Editor/EditorToolbar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Style Panel Components</name>
  <files>src/components/StylePanel/StylePanel.tsx, src/components/StylePanel/PresetSection.tsx, src/components/StylePanel/PresetButton.tsx, src/components/StylePanel/index.ts</files>
  <action>
Create the slide-in style panel with accordion sections.

**StylePanel.tsx:**
```typescript
interface StylePanelProps {
  isOpen: boolean
  onClose: () => void
}

export function StylePanel({ isOpen, onClose }: StylePanelProps)
```

**Layout:**
- Fixed position, right: 0, height: 100vh
- Width: 320px (CSS variable --panel-width for future adjustment)
- Background: var(--color-bg-surface)
- Border-left: 1px solid var(--color-border)
- z-index: 40

**Animation:**
- transform: translateX(100%) when closed, translateX(0) when open
- transition: transform 200ms ease-out
- Main content area gets margin-right: 320px when panel open (pushes, not overlays)

**Header:**
- Title: "Styles"
- Close button (X)
- "Reset" button (reverts to document's saved style)

**Sections (accordion):**
1. Typography (expanded by default)
2. Colors
3. Canvas

**Footer:**
- "Save Current Style" button
- "Set as Default" button

**PresetSection.tsx:**
```typescript
interface PresetSectionProps {
  title: string
  isExpanded: boolean
  onToggle: () => void
  children: React.ReactNode
}
```
- Accordion header with chevron
- Content area with max-height transition
- "Recently Used" sub-section at top (if recents exist)
- Filter input (simple text filter by name)
- Grid of preset buttons

**PresetButton.tsx:**
```typescript
interface PresetButtonProps {
  name: string
  isActive: boolean
  isCustom?: boolean  // Visual distinction for user-created
  onClick: () => void
}
```
- Simple button with preset name
- Active state: highlighted background
- Custom presets: small icon or colored dot indicator
- Hover state

Export all from index.ts.
  </action>
  <verify>Import StylePanel, render with isOpen=true. Panel should appear on right side with accordion sections.</verify>
  <done>Style panel slides in/out, has three accordion sections, presets are clickable buttons, recently used section works</done>
</task>

<task type="auto">
  <name>Task 2: Format Painter Hook</name>
  <files>src/hooks/useFormatPainter.ts, src/hooks/index.ts</files>
  <action>
Create a hook that manages format painter logic.

```typescript
interface UseFormatPainterReturn {
  isActive: boolean
  mode: 'toggle' | 'hold'
  hasStoredFormat: boolean

  // Actions
  captureAndActivate: () => void  // Capture current selection's format, activate painter
  applyToSelection: () => void    // Apply stored format to current selection
  toggle: () => void              // Toggle active state (for button click)
  deactivate: () => void          // Turn off painter

  // For keyboard hold mode
  startHold: () => void           // Start hold mode (key down)
  endHold: () => void             // End hold mode (key up)
}

export function useFormatPainter(editor: Editor | null): UseFormatPainterReturn
```

**captureAndActivate logic:**
1. Get current selection marks: `editor.state.storedMarks || $from.marks()`
2. Get paragraph attributes: `editor.getAttributes('paragraph')`
3. Store in styleStore.formatPainter.storedFormat
4. Set formatPainter.active = true

**applyToSelection logic:**
1. If no storedFormat, return
2. For each stored mark, call `editor.chain().focus().setMark(type, attrs).run()`
3. Apply textAlign if stored: `editor.chain().focus().setTextAlign(align).run()`
4. If mode === 'toggle', stay active; if mode === 'hold', active state controlled by key

**Keyboard integration:**
- Register Cmd+Shift+C to capture (or your chosen shortcut)
- Hold Cmd+Shift while clicking to apply (hold mode)
- The hook should work with useHotkeys from react-hotkeys-hook

**Visual cursor:**
- When active, add class to document.body: 'format-painter-active'
- CSS: `.format-painter-active { cursor: url('/paintbrush.svg') 0 16, copy; }`
- (Or use a simpler approach: cursor: copy;)

Export from hooks/index.ts.
  </action>
  <verify>In console: activate format painter on bold text, select plain text, call apply. Plain text should become bold.</verify>
  <done>Hook captures marks and node attrs, applies them to new selection, toggle and hold modes work, cursor changes when active</done>
</task>

<task type="auto">
  <name>Task 3: Format Painter Toolbar Button</name>
  <files>src/components/FormatPainter/FormatPainter.tsx, src/components/FormatPainter/index.ts</files>
  <action>
Create the toolbar button component for format painter.

```typescript
interface FormatPainterProps {
  editor: Editor
}

export function FormatPainter({ editor }: FormatPainterProps)
```

**Button behavior:**
1. Click captures current selection's format AND activates painter
2. If already active, click deactivates
3. Visual state: highlighted when active

**UI:**
- Icon: paintbrush (use emoji or simple SVG)
- Tooltip: "Format Painter (Cmd+Shift+C)"
- Active state: same as other toolbar buttons (bg-gray-200)

**Keyboard shortcuts (register in component):**
- Cmd+Shift+C: Toggle format painter
- While format painter is active, next click applies format

**Hold mode support:**
- If user holds Cmd+Shift and clicks, apply format
- Release Cmd+Shift deactivates (if in hold mode)

Export from index.ts.

**Integration point:** This component will be added to EditorToolbar in Plan 04.
  </action>
  <verify>Render FormatPainter component, click it, verify it shows active state. Click again, verify it deactivates.</verify>
  <done>Format painter button works in toolbar, click toggles active state, visual feedback when active</done>
</task>

</tasks>

<verification>
1. Style panel opens when triggered, closes when X clicked
2. Panel pushes content (margin-right on main content)
3. Accordion sections expand/collapse, only one at a time
4. Clicking preset updates document styling instantly
5. Format painter: select bold text, activate, select plain text, click. Plain text becomes bold.
6. Format painter toggle mode: stays active after applying, apply multiple times
</verification>

<success_criteria>
- [ ] StylePanel component renders and animates in/out
- [ ] Panel pushes content, doesn't overlay
- [ ] Accordion sections work (one expanded at a time)
- [ ] Clicking preset calls styleStore.setTypography/setColor/setCanvas
- [ ] Recently used section shows last 5 used presets
- [ ] Format painter captures marks and attributes
- [ ] Format painter applies stored format to new selection
- [ ] Format painter has working toggle and hold modes
- [ ] Visual feedback when format painter is active
</success_criteria>

<output>
After completion, create `.planning/phases/03-style-system/03-03-SUMMARY.md`
</output>
