---
phase: 03-style-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/themes.css
  - src/lib/presets.ts
  - src/hooks/useSystemTheme.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "CSS variables exist for all typography tokens (font-family, size, line-height)"
    - "CSS variables exist for all color tokens (text, background, accent, borders)"
    - "CSS variables exist for canvas backgrounds (solid, gradient, pattern)"
    - "Preset definitions are TypeScript objects with type safety"
    - "System theme detection works and fires on macOS dark/light changes"
  artifacts:
    - path: "src/styles/themes.css"
      provides: "CSS custom property definitions for all style tokens"
      contains: ":root"
    - path: "src/lib/presets.ts"
      provides: "TypeScript preset definitions (typography, colors, canvas)"
      exports: ["TYPOGRAPHY_PRESETS", "COLOR_PRESETS", "CANVAS_PRESETS", "applyPreset"]
    - path: "src/hooks/useSystemTheme.ts"
      provides: "Tauri theme detection with override support"
      exports: ["useSystemTheme"]
  key_links:
    - from: "src/lib/presets.ts"
      to: "src/styles/themes.css"
      via: "CSS variable names must match"
      pattern: "--font-|--color-|--canvas-"
---

<objective>
Create the CSS variable foundation and preset data structures for the entire style system.

Purpose: This is the foundation layer. All style tokens (typography, colors, canvas) are defined as CSS custom properties. Preset data is TypeScript objects that map to these variables. Theme detection integrates with Tauri's window API.

Output: Working CSS variable system, type-safe preset definitions, theme detection hook
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-style-system/03-CONTEXT.md
@.planning/phases/03-style-system/03-RESEARCH.md
@src/styles/editor.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: CSS Variable Foundation</name>
  <files>src/styles/themes.css</files>
  <action>
Create a new CSS file defining ALL style tokens as CSS custom properties on `:root`.

**Typography variables (used by all 23 presets):**
```css
--font-body: Georgia, serif;
--font-heading: -apple-system, sans-serif;
--font-mono: ui-monospace, SFMono-Regular, monospace;
--font-size-base: 16px;
--font-size-h1: 2rem;
--font-size-h2: 1.5rem;
--font-size-h3: 1.25rem;
--line-height-body: 1.6;
--line-height-heading: 1.2;
--letter-spacing-body: 0;
--letter-spacing-heading: -0.02em;
```

**Color variables (with light and dark variants):**
```css
/* Light mode (default) */
--color-text-primary: #1a1a1a;
--color-text-secondary: #4b5563;
--color-text-muted: #9ca3af;
--color-bg-page: #fafafa;
--color-bg-canvas: #ffffff;
--color-bg-surface: #f3f4f6;
--color-accent: #2563eb;
--color-accent-hover: #1d4ed8;
--color-border: #e5e7eb;
--color-border-strong: #d1d5db;
--color-highlight: #fef08a;
--color-link: #2563eb;
--color-code-bg: #f3f4f6;
--color-code-text: #1a1a1a;
--color-blockquote-border: #d1d5db;
--color-blockquote-text: #4b5563;

/* Dark mode override via data-theme attribute */
:root[data-theme="dark"] {
  --color-text-primary: #f5f5f5;
  --color-text-secondary: #a1a1aa;
  /* ... all dark variants */
}
```

**Canvas background variables:**
```css
--canvas-bg-color: var(--color-bg-canvas);
--canvas-bg-image: none;
--canvas-bg-size: auto;
--canvas-bg-position: center;
--canvas-bg-repeat: no-repeat;
```

Import this file in `src/index.css` (add `@import './styles/themes.css';` after tailwind).
  </action>
  <verify>File exists, can be parsed by PostCSS, no syntax errors. Run `npm run build` to verify.</verify>
  <done>All typography, color, and canvas CSS variables defined on :root, dark mode variant via data-theme selector</done>
</task>

<task type="auto">
  <name>Task 2: Preset Data Definitions</name>
  <files>src/lib/presets.ts</files>
  <action>
Create TypeScript interfaces and preset data arrays.

**Interfaces:**
```typescript
interface TypographyPreset {
  id: string
  name: string
  variables: Record<string, string>
}

interface ColorPreset {
  id: string
  name: string
  light: Record<string, string>  // Light mode variable values
  dark: Record<string, string>   // Dark mode variable values
}

interface CanvasPreset {
  id: string
  name: string
  type: 'solid' | 'gradient' | 'pattern'
  variables: Record<string, string>
}
```

**Create starter presets (expand to full count later):**
- 6 typography presets initially: Classic Serif, Modern Sans, Monospace, Newspaper, Book, Minimal
- 5 color presets initially: Default, Sepia, Night, Ocean, Forest (each with light+dark variants)
- 5 canvas presets initially: White, Cream, Gradient Soft, Paper Texture, Dots Pattern

**Utility functions:**
```typescript
export function applyTypographyPreset(presetId: string): void
export function applyColorPreset(presetId: string, mode: 'light' | 'dark'): void
export function applyCanvasPreset(presetId: string): void
export function getPresetById(type: 'typography' | 'color' | 'canvas', id: string): Preset | undefined
```

The `apply*` functions use `document.documentElement.style.setProperty()` to update CSS variables.

**IMPORTANT:** Variable names in preset objects MUST match the CSS variable names exactly (e.g., `'--font-body'`, not `'fontBody'`).
  </action>
  <verify>TypeScript compiles without errors. Import in a test file and verify types are correct.</verify>
  <done>TypeScript preset interfaces defined, 6 typography + 5 color + 5 canvas presets implemented, apply functions working</done>
</task>

<task type="auto">
  <name>Task 3: System Theme Detection Hook</name>
  <files>src/hooks/useSystemTheme.ts, src/hooks/index.ts</files>
  <action>
Create a React hook that wraps Tauri's window theme API.

```typescript
import { getCurrentWindow } from '@tauri-apps/api/window'
import { useState, useEffect, useCallback } from 'react'

type ThemeMode = 'light' | 'dark' | 'system'
type EffectiveTheme = 'light' | 'dark'

interface UseSystemThemeReturn {
  effectiveTheme: EffectiveTheme      // What's actually applied
  systemTheme: EffectiveTheme         // What macOS says
  userOverride: ThemeMode             // User's preference (system/light/dark)
  setUserOverride: (mode: ThemeMode) => void
  toggleTheme: () => void             // Quick toggle light<->dark
}

export function useSystemTheme(): UseSystemThemeReturn
```

**Implementation details:**
1. On mount, call `getCurrentWindow().theme()` to get initial system theme
2. Subscribe to `onThemeChanged()` for real-time updates
3. Store `userOverride` in memory (will be persisted by styleStore later)
4. `effectiveTheme` = userOverride === 'system' ? systemTheme : userOverride
5. Update `document.documentElement.dataset.theme` when effectiveTheme changes
6. Clean up listener on unmount

**Handle Tauri not being available (dev in browser):**
- Fallback to `window.matchMedia('(prefers-color-scheme: dark)')` if Tauri API fails
- Log warning but don't crash

Export from `src/hooks/index.ts`.
  </action>
  <verify>Run app in Tauri dev mode, toggle macOS System Settings > Appearance. Theme should update instantly.</verify>
  <done>Hook detects system theme, supports override, updates data-theme attribute on document element</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds (CSS and TS compile)
2. Browser dev tools show CSS variables on `:root` element
3. Theme toggle test: Change macOS appearance, verify `data-theme` attribute updates
4. Console: Import presets.ts, call `applyTypographyPreset('classic-serif')`, verify variables change
</verification>

<success_criteria>
- [ ] CSS file with all style tokens exists and is imported
- [ ] TypeScript presets file exports typed preset arrays
- [ ] apply* functions update CSS variables on document.documentElement
- [ ] useSystemTheme hook detects system theme and supports override
- [ ] data-theme attribute on :root responds to theme changes
- [ ] No TypeScript or CSS compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-style-system/03-01-SUMMARY.md`
</output>
