---
phase: 03-style-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/themes.css
  - src/lib/presets.ts
  - src/hooks/useSystemTheme.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "CSS variables exist for all typography tokens (font-family, size, line-height)"
    - "CSS variables exist for all color tokens (text, background, accent, borders)"
    - "CSS variables exist for canvas backgrounds (solid, gradient, pattern)"
    - "CSS variables exist for layout tokens (margins, text-align, line-spacing, page-width)"
    - "Preset definitions are TypeScript objects with type safety"
    - "System theme detection works and fires on macOS dark/light changes"
  artifacts:
    - path: "src/styles/themes.css"
      provides: "CSS custom property definitions for all style tokens"
      contains: ":root"
    - path: "src/lib/presets.ts"
      provides: "TypeScript preset definitions (typography, colors, canvas, layout, master themes)"
      exports: ["TYPOGRAPHY_PRESETS", "COLOR_PRESETS", "CANVAS_PRESETS", "LAYOUT_PRESETS", "MASTER_THEMES", "applyPreset"]
    - path: "src/hooks/useSystemTheme.ts"
      provides: "Tauri theme detection with override support"
      exports: ["useSystemTheme"]
  key_links:
    - from: "src/lib/presets.ts"
      to: "src/styles/themes.css"
      via: "CSS variable names must match"
      pattern: "--font-|--color-|--canvas-|--layout-"
---

<objective>
Create the CSS variable foundation and preset data structures for the entire style system.

Purpose: This is the foundation layer. All style tokens (typography, colors, canvas, layout) are defined as CSS custom properties. Preset data is TypeScript objects that map to these variables. Theme detection integrates with Tauri's window API.

Output: Working CSS variable system, type-safe preset definitions, theme detection hook
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-style-system/03-CONTEXT.md
@.planning/phases/03-style-system/03-RESEARCH.md
@src/styles/editor.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: CSS Variable Foundation</name>
  <files>src/styles/themes.css</files>
  <action>
Create a new CSS file defining ALL style tokens as CSS custom properties on `:root`.

**Typography variables (used by all 23 presets):**
```css
--font-body: Georgia, serif;
--font-heading: -apple-system, sans-serif;
--font-mono: ui-monospace, SFMono-Regular, monospace;
--font-size-base: 16px;
--font-size-h1: 2rem;
--font-size-h2: 1.5rem;
--font-size-h3: 1.25rem;
--line-height-body: 1.6;
--line-height-heading: 1.2;
--letter-spacing-body: 0;
--letter-spacing-heading: -0.02em;
```

**Color variables (with light and dark variants):**
```css
/* Light mode (default) */
--color-text-primary: #1a1a1a;
--color-text-secondary: #4b5563;
--color-text-muted: #9ca3af;
--color-bg-page: #fafafa;
--color-bg-canvas: #ffffff;
--color-bg-surface: #f3f4f6;
--color-accent: #2563eb;
--color-accent-hover: #1d4ed8;
--color-border: #e5e7eb;
--color-border-strong: #d1d5db;
--color-highlight: #fef08a;
--color-link: #2563eb;
--color-code-bg: #f3f4f6;
--color-code-text: #1a1a1a;
--color-blockquote-border: #d1d5db;
--color-blockquote-text: #4b5563;

/* Dark mode override via data-theme attribute */
:root[data-theme="dark"] {
  --color-text-primary: #f5f5f5;
  --color-text-secondary: #a1a1aa;
  /* ... all dark variants */
}
```

**Canvas background variables:**
```css
--canvas-bg-color: var(--color-bg-canvas);
--canvas-bg-image: none;
--canvas-bg-size: auto;
--canvas-bg-position: center;
--canvas-bg-repeat: no-repeat;
```

**Layout variables (NEW - for STYLE-03):**
```css
/* Text alignment and spacing */
--layout-text-align: left;
--layout-paragraph-spacing: 1rem;
--layout-paragraph-indent: 0;
--layout-line-spacing: 1.6;

/* Page margins and width */
--layout-margin-top: 2rem;
--layout-margin-bottom: 2rem;
--layout-margin-left: 2rem;
--layout-margin-right: 2rem;
--layout-page-max-width: 720px;
--layout-page-padding: 1.5rem;

/* List and block styling */
--layout-list-indent: 1.5rem;
--layout-blockquote-indent: 1rem;
--layout-heading-margin-top: 1.5em;
--layout-heading-margin-bottom: 0.5em;
```

Import this file in `src/index.css` (add `@import './styles/themes.css';` after tailwind).
  </action>
  <verify>File exists, can be parsed by PostCSS, no syntax errors. Run `npm run build` to verify.</verify>
  <done>All typography, color, canvas, and layout CSS variables defined on :root, dark mode variant via data-theme selector</done>
</task>

<task type="auto">
  <name>Task 2: Preset Data Definitions</name>
  <files>src/lib/presets.ts</files>
  <action>
Create TypeScript interfaces and preset data arrays. Full preset counts required by requirements.

**Interfaces:**
```typescript
interface TypographyPreset {
  id: string
  name: string
  variables: Record<string, string>
}

interface ColorPreset {
  id: string
  name: string
  light: Record<string, string>  // Light mode variable values
  dark: Record<string, string>   // Dark mode variable values
}

interface CanvasPreset {
  id: string
  name: string
  type: 'solid' | 'gradient' | 'pattern'
  variables: Record<string, string>
}

interface LayoutPreset {
  id: string
  name: string
  variables: Record<string, string>
}

interface MasterTheme {
  id: string
  name: string
  typography: string  // preset ID
  colors: string      // preset ID
  canvas: string      // preset ID
  layout: string      // preset ID
}
```

**Create ALL presets (full counts per requirements):**

**Typography (23 presets):**
1. SERQ Default, 2. Classic Serif, 3. Modern Sans, 4. Monospace, 5. Newspaper, 6. Book, 7. Minimal, 8. Academic, 9. Magazine, 10. Screenplay, 11. Novel, 12. Technical, 13. Legal, 14. Casual, 15. Elegant, 16. Compact, 17. Spacious, 18. Traditional, 19. Contemporary, 20. Handwritten, 21. Typewriter, 22. Clean, 23. Bold

**Colors (25 presets - each with light+dark variants):**
1. Default, 2. Sepia, 3. Night, 4. Ocean, 5. Forest, 6. Sunset, 7. Midnight, 8. Paper, 9. Ink, 10. Warm, 11. Cool, 12. Muted, 13. Vibrant, 14. Pastel, 15. Earth, 16. Sky, 17. Lavender, 18. Mint, 19. Rose, 20. Slate, 21. Sand, 22. Storm, 23. Autumn, 24. Spring, 25. Monochrome

**Canvas (25 presets):**
1. White, 2. Cream, 3. Light Gray, 4. Warm White, 5. Cool White, 6-10. Gradient Soft/Sunrise/Ocean/Forest/Sunset, 11-15. Paper Texture/Parchment/Linen/Canvas/Cork, 16-20. Dots/Grid/Lines/Crosshatch/Waves, 21-25. Dark variants (Dark Gray, Charcoal, Midnight Blue, Deep Purple, Black)

**Layout (25 presets):**
1. Default, 2. Narrow, 3. Wide, 4. Full Width, 5. Centered, 6. Left-Aligned, 7. Right-Aligned, 8. Justified, 9. Compact, 10. Spacious, 11. Academic (wider margins), 12. Novel (book-like), 13. Screenplay, 14. Legal, 15. Letter, 16. A4, 17. Manuscript, 18. Blog, 19. Report, 20. Presentation, 21. Dense, 22. Airy, 23. Classic, 24. Modern, 25. Minimal

**Master Themes (33 predefined combinations - STYLE-04):**
```typescript
export const MASTER_THEMES: MasterTheme[] = [
  // Writing modes
  { id: 'novelist', name: 'Novelist', typography: 'book', colors: 'sepia', canvas: 'cream', layout: 'novel' },
  { id: 'journalist', name: 'Journalist', typography: 'newspaper', colors: 'paper', canvas: 'white', layout: 'narrow' },
  { id: 'academic', name: 'Academic', typography: 'academic', colors: 'default', canvas: 'white', layout: 'academic' },
  { id: 'screenwriter', name: 'Screenwriter', typography: 'screenplay', colors: 'paper', canvas: 'white', layout: 'screenplay' },
  { id: 'blogger', name: 'Blogger', typography: 'modern-sans', colors: 'default', canvas: 'white', layout: 'blog' },
  // Dark modes
  { id: 'night-owl', name: 'Night Owl', typography: 'modern-sans', colors: 'midnight', canvas: 'charcoal', layout: 'spacious' },
  { id: 'deep-focus', name: 'Deep Focus', typography: 'minimal', colors: 'night', canvas: 'dark-gray', layout: 'centered' },
  // ... 26 more master themes covering various use cases
]
```

**Utility functions:**
```typescript
export function applyTypographyPreset(presetId: string): void
export function applyColorPreset(presetId: string, mode: 'light' | 'dark'): void
export function applyCanvasPreset(presetId: string): void
export function applyLayoutPreset(presetId: string): void
export function applyMasterTheme(themeId: string, mode: 'light' | 'dark'): void
export function getPresetById(type: 'typography' | 'color' | 'canvas' | 'layout', id: string): Preset | undefined
export function getMasterThemeById(id: string): MasterTheme | undefined
```

The `apply*` functions use `document.documentElement.style.setProperty()` to update CSS variables.

**IMPORTANT:** Variable names in preset objects MUST match the CSS variable names exactly (e.g., `'--font-body'`, not `'fontBody'`).
  </action>
  <verify>TypeScript compiles without errors. Import in a test file and verify types are correct.</verify>
  <done>TypeScript preset interfaces defined, 23 typography + 25 color + 25 canvas + 25 layout presets + 33 master themes implemented, apply functions working</done>
</task>

<task type="auto">
  <name>Task 3: System Theme Detection Hook</name>
  <files>src/hooks/useSystemTheme.ts, src/hooks/index.ts</files>
  <action>
Create a React hook that wraps Tauri's window theme API.

```typescript
import { getCurrentWindow } from '@tauri-apps/api/window'
import { useState, useEffect, useCallback } from 'react'

type ThemeMode = 'light' | 'dark' | 'system'
type EffectiveTheme = 'light' | 'dark'

interface UseSystemThemeReturn {
  effectiveTheme: EffectiveTheme      // What's actually applied
  systemTheme: EffectiveTheme         // What macOS says
  userOverride: ThemeMode             // User's preference (system/light/dark)
  setUserOverride: (mode: ThemeMode) => void
  toggleTheme: () => void             // Quick toggle light<->dark
}

export function useSystemTheme(): UseSystemThemeReturn
```

**Implementation details:**
1. On mount, call `getCurrentWindow().theme()` to get initial system theme
2. Subscribe to `onThemeChanged()` for real-time updates
3. Store `userOverride` in memory (will be persisted by styleStore later)
4. `effectiveTheme` = userOverride === 'system' ? systemTheme : userOverride
5. Update `document.documentElement.dataset.theme` when effectiveTheme changes
6. Clean up listener on unmount

**Handle Tauri not being available (dev in browser):**
- Fallback to `window.matchMedia('(prefers-color-scheme: dark)')` if Tauri API fails
- Log warning but don't crash

Export from `src/hooks/index.ts`.
  </action>
  <verify>Run app in Tauri dev mode, toggle macOS System Settings > Appearance. Theme should update instantly.</verify>
  <done>Hook detects system theme, supports override, updates data-theme attribute on document element</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds (CSS and TS compile)
2. Browser dev tools show CSS variables on `:root` element (including layout variables)
3. Theme toggle test: Change macOS appearance, verify `data-theme` attribute updates
4. Console: Import presets.ts, verify all preset arrays have correct counts (23, 25, 25, 25, 33)
5. Console: call `applyTypographyPreset('classic-serif')`, verify variables change
</verification>

<success_criteria>
- [ ] CSS file with all style tokens exists and is imported (typography, colors, canvas, layout)
- [ ] TypeScript presets file exports typed preset arrays with full counts
- [ ] 23 typography + 25 color + 25 canvas + 25 layout presets defined
- [ ] 33 master themes (predefined combinations) defined
- [ ] apply* functions update CSS variables on document.documentElement
- [ ] useSystemTheme hook detects system theme and supports override
- [ ] data-theme attribute on :root responds to theme changes
- [ ] No TypeScript or CSS compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-style-system/03-01-SUMMARY.md`
</output>
