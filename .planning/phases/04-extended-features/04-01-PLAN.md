---
phase: 04-extended-features
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Editor/EditorCore.tsx
  - src/components/Editor/EditorToolbar.tsx
  - src/styles/tables.css
  - src/components/Editor/TableContextMenu.tsx
autonomous: true

must_haves:
  truths:
    - "User can insert a table with dimension picker via toolbar"
    - "User can add and remove rows and columns"
    - "User can merge and split cells"
    - "User can resize columns by dragging borders"
    - "User can toggle header row styling"
    - "User can set cell background color"
  artifacts:
    - path: "src/components/Editor/EditorCore.tsx"
      provides: "Table extensions registered"
      contains: "@tiptap/extension-table"
    - path: "src/components/Editor/EditorToolbar.tsx"
      provides: "Table toolbar button with dimension picker"
      contains: "insertTable"
    - path: "src/styles/tables.css"
      provides: "Table styling with borders and resize handles"
      contains: ".tableWrapper"
    - path: "src/components/Editor/TableContextMenu.tsx"
      provides: "Context menu for cell operations"
      exports: ["TableContextMenu"]
  key_links:
    - from: "EditorCore.tsx"
      to: "Table extension"
      via: "extensions array"
      pattern: "Table\\.configure"
    - from: "EditorToolbar.tsx"
      to: "editor.chain().insertTable"
      via: "onClick handler"
      pattern: "insertTable.*rows.*cols"
---

<objective>
Add full table editing support with TipTap's official Table extension.

Purpose: Tables are a core expectation for any document editor. Users need to organize tabular data with standard operations (merge, resize, style).

Output: Working table system with toolbar insertion, context menu operations, and proper styling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-extended-features/04-CONTEXT.md
@.planning/phases/04-extended-features/04-RESEARCH.md
@src/components/Editor/EditorCore.tsx
@src/components/Editor/EditorToolbar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure Table extensions</name>
  <files>
    package.json
    src/components/Editor/EditorCore.tsx
    src/styles/tables.css
  </files>
  <action>
    Install TipTap table extensions:
    ```bash
    npm install @tiptap/extension-table @tiptap/extension-table-row @tiptap/extension-table-cell @tiptap/extension-table-header
    ```

    In EditorCore.tsx, import and configure all four table extensions:
    - Table.configure({ resizable: true, handleWidth: 5, cellMinWidth: 100, lastColumnResizable: true, allowTableNodeSelection: true })
    - TableRow
    - TableHeader
    - TableCell

    CRITICAL: All four extensions MUST be installed together (Table requires the other three).

    Create src/styles/tables.css with:
    - .tableWrapper with position: relative, max-width: 100%
    - table styling: border-collapse: collapse, width: 100%
    - td/th styling: border 1px, padding 0.5rem, min-width 100px
    - Header row styling via .ProseMirror table th
    - Resize handle styling for column drag: border-right on hover
    - 4px border-radius on outer table frame
    - Cell selection styling (background highlight for selected cells)

    Import tables.css in EditorCore.tsx or main.tsx.
  </action>
  <verify>
    Run dev server, manually type table HTML into editor:
    `<table><tr><th>A</th><th>B</th></tr><tr><td>1</td><td>2</td></tr></table>`
    Table should render with borders and resize handles visible on column borders.
  </verify>
  <done>
    Table extensions installed and configured, tables render with proper styling and resize handles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Table toolbar button with dimension picker</name>
  <files>
    src/components/Editor/EditorToolbar.tsx
    src/components/Editor/TablePicker.tsx
  </files>
  <action>
    Create TablePicker.tsx component:
    - Grid of cells (8 cols x 6 rows) for dimension selection
    - Hover to highlight selection area (like Word/Notion)
    - Display current selection (e.g., "3 x 4") below grid
    - Click to insert table with selected dimensions
    - Default highlight: 3 cols x 4 rows

    Add table button to EditorToolbar.tsx:
    - Icon: grid/table icon (4 squares in 2x2)
    - Click shows TablePicker dropdown/popover
    - On dimension select: editor.chain().focus().insertTable({ rows: N, cols: M, withHeaderRow: false }).run()
    - Note: withHeaderRow false per CONTEXT (toggle option, not automatic)

    Use absolute positioning for picker dropdown, close on click outside.
  </action>
  <verify>
    Click table button in toolbar, see picker grid. Hover to select 3x4. Click. Table appears in editor with 3 columns and 4 rows.
  </verify>
  <done>
    Table insertion via toolbar works with visual dimension picker.
  </done>
</task>

<task type="auto">
  <name>Task 3: Table context menu with cell operations</name>
  <files>
    src/components/Editor/TableContextMenu.tsx
    src/components/Editor/EditorWrapper.tsx
    src/styles/tables.css
  </files>
  <action>
    Create TableContextMenu.tsx component:
    - Show on right-click when cursor is in table cell
    - Position at mouse coordinates
    - Menu sections:
      1. Row operations: Insert row above, Insert row below, Delete row
      2. Column operations: Insert column left, Insert column right, Delete column
      3. Cell operations: Merge cells (when multiple selected), Split cell
      4. Header: Toggle header row
      5. Background: 8 color preset buttons (from CONTEXT)
      6. Borders: Toggle all, Frame only, Vertical only, Horizontal only

    Use editor commands:
    - editor.chain().focus().addRowBefore().run()
    - editor.chain().focus().addRowAfter().run()
    - editor.chain().focus().deleteRow().run()
    - editor.chain().focus().addColumnBefore().run()
    - editor.chain().focus().addColumnAfter().run()
    - editor.chain().focus().deleteColumn().run()
    - editor.chain().focus().mergeCells().run()
    - editor.chain().focus().splitCell().run()
    - editor.chain().focus().toggleHeaderRow().run()
    - editor.chain().focus().setCellAttribute('backgroundColor', color).run()

    For borders, use setCellAttribute with custom border attributes. Add CSS to support these.

    Wire context menu in EditorWrapper or EditorCore:
    - Listen for contextmenu event on table cells
    - Show TableContextMenu at event coordinates
    - Pass editor instance to menu
    - Close menu on click outside or Escape

    Add styling for color picker row (8 small squares) and menu sections in tables.css.
  </action>
  <verify>
    Right-click in table cell, context menu appears. Add row below, verify new row. Toggle header row, verify styling change. Set cell background to blue, verify color applies.
  </verify>
  <done>
    Full table context menu with row/column operations, merge/split, header toggle, colors, and border controls.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Insert table via toolbar picker (3x4)
2. Type content in cells
3. Resize a column by dragging border
4. Right-click, add row below
5. Right-click, toggle header row
6. Select two cells, right-click, merge
7. Right-click merged cell, split
8. Right-click, change cell background color

All operations should work without console errors.
</verification>

<success_criteria>
- Table insertable via toolbar dimension picker
- All row/column operations work via context menu
- Cell merge/split functional
- Column resize by dragging works
- Header row toggle applies styling
- Cell background color changeable
- Tables render with proper borders and 4px corner radius
</success_criteria>

<output>
After completion, create `.planning/phases/04-extended-features/04-01-SUMMARY.md`
</output>
