---
phase: 05-polish
plan: 07
type: execute
wave: 3
depends_on: ["05-01", "05-02", "05-03", "05-04", "05-05", "05-06"]
files_modified:
  - src/App.tsx
  - src/components/Editor/EditorWrapper.tsx
  - src/main.tsx
autonomous: false

must_haves:
  truths:
    - "All Phase 5 features integrated and working together"
    - "Version history auto-saves and checkpoints function correctly"
    - "Comments can be added, viewed, and managed"
    - "Export/Import work for all supported formats"
    - "Focus mode hides all UI chrome"
    - "Status bar shows accurate word/character count"
---

<objective>
Integrate all Phase 5 components and verify complete functionality.

Purpose: Connect all the pieces built in previous plans. Register extensions, wire up panels, add CSS imports, and verify the complete system works together before human verification.

Output:
- All Phase 5 components integrated into App
- CSS files imported in correct order
- Extensions registered with TipTap
- Human verification of all success criteria
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-polish/05-01-SUMMARY.md
@.planning/phases/05-polish/05-02-SUMMARY.md
@.planning/phases/05-polish/05-03-SUMMARY.md
@.planning/phases/05-polish/05-04-SUMMARY.md
@.planning/phases/05-polish/05-05-SUMMARY.md
@.planning/phases/05-polish/05-06-SUMMARY.md

# Integration targets
@src/App.tsx
@src/components/Editor/EditorWrapper.tsx
@src/components/Editor/EditorCore.tsx
@src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Import CSS files and register extensions</name>
  <files>
    src/main.tsx
    src/components/Editor/EditorCore.tsx
  </files>
  <action>
1. Update `src/main.tsx` to import new CSS files:

Add imports after existing CSS imports:
```typescript
import './styles/focus-mode.css';
import './styles/version-history.css';
import './styles/comments.css';
```

2. Update `src/components/Editor/EditorCore.tsx` to register new extensions:

Add imports:
```typescript
import { TypewriterMode } from '../../extensions/TypewriterMode';
import { Comment } from '../../extensions/Comment/Comment';
import { useCommentStore } from '../../stores/commentStore';
```

In the useEditor extensions array, add:
```typescript
TypewriterMode.configure({
  enabled: false, // Disabled by default, toggled via StatusBar
}),
Comment.configure({
  HTMLAttributes: {
    class: 'comment-mark',
  },
  onCommentActivated: (commentId: string) => {
    // Activate comment in store and open panel
    useCommentStore.getState().setActiveComment(commentId);
    useCommentStore.getState().setPanelOpen(true);
  },
}),
```

Note: Ensure extensions are added AFTER StarterKit to avoid conflicts.
  </action>
  <verify>
    Run `npm run build` - TypeScript compiles without errors
  </verify>
  <done>
    CSS files imported, TypewriterMode and Comment extensions registered
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate panels and hooks into App</name>
  <files>
    src/App.tsx
    src/components/Editor/EditorWrapper.tsx
  </files>
  <action>
1. Update `src/App.tsx` to add version history and comment panels:

Add imports:
```typescript
import { VersionHistoryPanel } from './components/VersionHistory';
import { CommentPanel } from './components/Comments';
import { StatusBar } from './components/StatusBar';
import { ExportMenu } from './components/ExportMenu';
import { useFocusMode } from './hooks';
import { useCommentStore } from './stores/commentStore';
```

Add state and hooks in App component:
```typescript
const [isVersionHistoryOpen, setVersionHistoryOpen] = useState(false);
const { isFocusMode, toggleFocusMode } = useFocusMode();
const isCommentPanelOpen = useCommentStore((s) => s.isPanelOpen);
```

Add to command palette commands (or create keyboard shortcut):
```typescript
// Add command to open version history: Cmd+Shift+H
useHotkeys('mod+shift+h', () => setVersionHistoryOpen(true), { enableOnContentEditable: true });
```

Render panels in JSX (after existing panels, before closing tags):
```tsx
{/* Version History Panel */}
<VersionHistoryPanel
  isOpen={isVersionHistoryOpen}
  onClose={() => setVersionHistoryOpen(false)}
  editor={editorRef.current}
  interfaceColors={interfaceColors}
/>

{/* Comment Panel */}
<CommentPanel
  editor={editorRef.current}
  interfaceColors={interfaceColors}
/>

{/* Status Bar (at bottom, before focus mode takes over) */}
{!isFocusMode && (
  <StatusBar
    editor={editorRef.current}
    interfaceColors={interfaceColors}
    typewriterEnabled={false} // Connect to typewriter state if implemented
    onToggleTypewriter={() => {
      // Toggle typewriter mode via editor command
      editorRef.current?.commands.toggleTypewriterMode();
    }}
  />
)}
```

Add ExportMenu to toolbar area:
```tsx
<ExportMenu editor={editorRef.current} interfaceColors={interfaceColors} />
```

2. Update `src/components/Editor/EditorWrapper.tsx` to use auto-snapshot:

Add imports:
```typescript
import { useAutoSnapshot } from '../../hooks';
import { useEditorStore } from '../../stores/editorStore';
```

Add hook usage after editor is initialized:
```typescript
const documentPath = useEditorStore((s) => s.document.path);

// Auto-snapshot for version history
useAutoSnapshot(editor, documentPath, { enabled: !!documentPath });
```
  </action>
  <verify>
    Run `npm run build` - TypeScript compiles without errors
    Run `npm run tauri dev` - App starts without crashes
  </verify>
  <done>
    All Phase 5 panels integrated into App, auto-snapshot enabled, status bar rendered
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human verification of Phase 5 success criteria</name>
  <what-built>
Complete Phase 5 Polish features:
- Version history with SQLite storage and Time Machine-style UI
- Single-user commenting system with inline highlights
- Export to HTML, Markdown, and PDF
- Import from Word (.docx), Markdown, and plain text
- Focus mode (Cmd+Shift+F) hiding all UI chrome
- Status bar with word count, character count, cursor position
- Typewriter mode for centered cursor
  </what-built>
  <how-to-verify>
1. Start the app: `npm run tauri dev`

**Version History (VER-01 to VER-06)**
2. Create a new document and type several paragraphs
3. Save the document (Cmd+S) - should prompt for location
4. Wait 30+ seconds, make changes - auto-snapshot should save
5. Open version history (Cmd+Shift+H)
6. Verify: Version list shows auto-saves and checkpoint
7. Click a version - preview should show content
8. Click "Restore This Version" - should restore with backup checkpoint
9. Verify: Current content replaced with version content

**Comments (COMM-01 to COMM-04)**
10. Select some text in the document
11. Open command palette (Cmd+K) and search "comment"
12. Add a comment with some text
13. Verify: Text has yellow highlight
14. Click the highlight - comment panel should open
15. Verify: Comment shows in panel with text
16. Click "Resolve" - comment should move to Resolved section
17. Click "Delete" - confirm and verify highlight removed

**Export (EXP-01 to EXP-03)**
18. Click Export button in toolbar (or Cmd+K > "Export")
19. Export to HTML - should open save dialog, save file
20. Open saved HTML in browser - should look styled correctly
21. Export to Markdown - save and verify .md file has proper syntax
22. Export to PDF - should open print dialog

**Import (EXP-04 to EXP-06)**
23. Open command palette (Cmd+K) and search "import"
24. Import a Word document (.docx if available)
25. Verify: Content appears in editor, title shows "Imported - filename"
26. Create new document, import a Markdown file
27. Verify: Headers, lists, bold/italic converted correctly
28. Import plain text - verify content wrapped in paragraphs

**UI Polish (UI-02, UI-03, UI-05, UI-06)**
29. Press Cmd+Shift+F to enter focus mode
30. Verify: Toolbar, panels, status bar all hidden
31. Verify: Exit hint appears on hover at top
32. Press Escape to exit - UI should return
33. Look at status bar - verify word count, char count, Ln/Col
34. Type some text - counts should update
35. Click "Typewriter" toggle - cursor should stay centered while typing

**Final Checks**
36. Verify app doesn't crash during normal use
37. Check console for any errors
38. Test dark mode - all panels should respect theme
  </how-to-verify>
  <resume-signal>Type "approved" if all criteria pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. `npm run tauri dev` starts without crashes
3. All Phase 5 success criteria verified by human
</verification>

<success_criteria>
Per ROADMAP Phase 5 Success Criteria:
1. User can view version history (Time Machine style) and restore any previous version
2. User can add comments to text selections and see them in margin
3. User can export document to HTML, Markdown, and PDF
4. User can import Word (.docx), Markdown, and plain text files
5. User can toggle focus mode (Cmd+Shift+F) hiding all UI chrome
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish/05-07-SUMMARY.md`
</output>
