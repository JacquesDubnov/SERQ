/* ========================================
   Table Styles for TipTap Editor
   ======================================== */

/* Table wrapper - container provided by TipTap */
.tableWrapper {
  position: relative;
  width: 100%;
  max-width: 100%;
  margin: 1rem 0;
  overflow: hidden; /* Clips table during resize drag - prevents visual overflow */
}

/* Base table styling */
.editor-content .tiptap table {
  border-collapse: collapse;
  width: 100%;
  max-width: 100%;
  table-layout: fixed;
}

/* Applied by TableWidthLimit when table would overflow */
.editor-content .tiptap table.width-capped {
  width: 100% !important;
  max-width: 100% !important;
}

.editor-content .tiptap table.width-capped colgroup col {
  width: auto !important;
}

/* Outer frame border - same 1px as internal borders */
.editor-content .tiptap table {
  border: 1px solid var(--color-border, #e5e7eb);
  border-radius: 4px;
}

/* Table cells */
.editor-content .tiptap td,
.editor-content .tiptap th {
  border: 1px solid var(--color-border, #e5e7eb);
  padding: 0.5rem 0.75rem;
  min-width: 100px;
  vertical-align: top;
  position: relative;
  box-sizing: border-box;
  /* Prevent word breaking in table cells */
  word-break: normal;
  overflow-wrap: normal;
  hyphens: none;
}

/* Header row styling */
.editor-content .tiptap th {
  background-color: var(--color-bg-surface, #f9fafb);
  font-weight: 600;
  text-align: left;
  color: var(--color-text-primary);
}

/* Cell content inherits editor typography */
.editor-content .tiptap td p,
.editor-content .tiptap th p {
  margin: 0;
  text-indent: 0;
}

/* Allow full content in cells */
.editor-content .tiptap td > *:first-child,
.editor-content .tiptap th > *:first-child {
  margin-top: 0;
}

.editor-content .tiptap td > *:last-child,
.editor-content .tiptap th > *:last-child {
  margin-bottom: 0;
}

/* ========================================
   Column Resize Handles
   ======================================== */

/* Resize handle provided by TipTap */
.editor-content .tiptap .column-resize-handle {
  position: absolute;
  right: -2px;
  top: 0;
  bottom: 0;
  width: 4px;
  background-color: var(--color-accent, #2563eb);
  cursor: col-resize;
  z-index: 20;
}

/* While resizing columns */
.editor-content .tiptap.resize-cursor {
  cursor: col-resize;
}

/* Ensure cursor resets on mouseup - fallback (only for direct editor content) */
.editor-content .tiptap:not(.resize-cursor) > .ProseMirror-trailingBreak,
.editor-content .tiptap:not(.resize-cursor) > p,
.editor-content .tiptap:not(.resize-cursor) > h1,
.editor-content .tiptap:not(.resize-cursor) > h2,
.editor-content .tiptap:not(.resize-cursor) > h3 {
  cursor: text;
}

.editor-content .tiptap:not(.resize-cursor) .column-resize-handle {
  cursor: col-resize;
}

/* ========================================
   Cell Selection Styling
   ======================================== */

/* Selected cells highlight */
.editor-content .tiptap .selectedCell {
  background-color: rgba(37, 99, 235, 0.15) !important;
}

.editor-content .tiptap .selectedCell::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  border: 2px solid var(--color-accent, #2563eb);
}

/* Keep selection visible even when editor loses focus */
.editor-content .tiptap:not(:focus-within) .selectedCell {
  background-color: rgba(37, 99, 235, 0.15) !important;
}

.editor-content .tiptap:not(:focus-within) .selectedCell::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  border: 2px solid var(--color-accent, #2563eb);
}

/* Table selection (whole table selected) */
.editor-content .tiptap .ProseMirror-selectednode table {
  outline: 2px solid var(--color-accent, #2563eb);
  outline-offset: 2px;
}

/* ========================================
   Cell Background Colors
   ======================================== */

/* Cell background attribute styles */
.editor-content .tiptap td[data-background-color],
.editor-content .tiptap th[data-background-color] {
  background-color: attr(data-background-color);
}

/* Color presets - applied via style attribute by TipTap */
.editor-content .tiptap td[style*="background-color"],
.editor-content .tiptap th[style*="background-color"] {
  /* Preserve background-color from inline styles */
}

/* ========================================
   Border Variations (for context menu toggles)
   ======================================== */

/* No borders variant */
.editor-content .tiptap table.no-borders,
.editor-content .tiptap table.no-borders td,
.editor-content .tiptap table.no-borders th {
  border: none;
}

/* Frame only (outer borders) */
.editor-content .tiptap table.frame-only td,
.editor-content .tiptap table.frame-only th {
  border: none;
}

.editor-content .tiptap table.frame-only {
  border: 1px solid var(--color-border, #e5e7eb);
}

/* Horizontal lines only */
.editor-content .tiptap table.horizontal-only td,
.editor-content .tiptap table.horizontal-only th {
  border-left: none;
  border-right: none;
  border-top: 1px solid var(--color-border, #e5e7eb);
  border-bottom: 1px solid var(--color-border, #e5e7eb);
}

.editor-content .tiptap table.horizontal-only {
  border-left: none;
  border-right: none;
}

/* Vertical lines only */
.editor-content .tiptap table.vertical-only td,
.editor-content .tiptap table.vertical-only th {
  border-top: none;
  border-bottom: none;
  border-left: 1px solid var(--color-border, #e5e7eb);
  border-right: 1px solid var(--color-border, #e5e7eb);
}

.editor-content .tiptap table.vertical-only {
  border-top: none;
  border-bottom: none;
}

/* ========================================
   Table Context Menu Styles
   ======================================== */

.table-context-menu {
  position: fixed;
  background-color: var(--color-bg, #ffffff);
  border: 1px solid var(--color-border, #e5e7eb);
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  padding: 0.25rem 0;
  min-width: 180px;
  z-index: 1000;
  font-size: 0.875rem;
}

.table-context-menu-section {
  padding: 0.25rem 0;
  border-bottom: 1px solid var(--color-border, #e5e7eb);
}

.table-context-menu-section:last-child {
  border-bottom: none;
}

.table-context-menu-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.5rem 0.75rem;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  color: var(--color-text-primary, #1f2937);
  transition: background-color 0.1s ease;
}

.table-context-menu-item:hover {
  background-color: var(--color-bg-surface, #f3f4f6);
}

.table-context-menu-item:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.table-context-menu-item-icon {
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-text-secondary, #6b7280);
}

/* Section label */
.table-context-menu-label {
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-text-secondary, #6b7280);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Color picker row */
.table-context-menu-colors {
  display: flex;
  gap: 0.375rem;
  padding: 0.5rem 0.75rem;
}

.table-context-menu-color-btn {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  border: 1px solid var(--color-border, #e5e7eb);
  cursor: pointer;
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

.table-context-menu-color-btn:hover {
  transform: scale(1.15);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

.table-context-menu-color-btn.active {
  box-shadow: 0 0 0 2px var(--color-accent, #2563eb);
}

/* ========================================
   Dark Theme Overrides
   ======================================== */

:root[data-theme="dark"] .editor-content .tiptap table {
  border-color: var(--color-border, #374151);
}

:root[data-theme="dark"] .editor-content .tiptap td,
:root[data-theme="dark"] .editor-content .tiptap th {
  border-color: var(--color-border, #374151);
}

:root[data-theme="dark"] .editor-content .tiptap th {
  background-color: var(--color-bg-surface, #1f2937);
}

:root[data-theme="dark"] .table-context-menu {
  background-color: var(--color-bg, #1f2937);
  border-color: var(--color-border, #374151);
}

:root[data-theme="dark"] .table-context-menu-item:hover {
  background-color: var(--color-bg-surface, #374151);
}

/* ========================================
   Print Styles
   ======================================== */

@media print {
  .editor-content .tiptap table {
    page-break-inside: auto;
  }

  .editor-content .tiptap tr {
    page-break-inside: avoid;
    page-break-after: auto;
  }

  .column-resize-handle {
    display: none;
  }
}

/* ========================================
   Gap Cursor (for clicking before/after tables)
   ======================================== */

.editor-content .tiptap .ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
}

.editor-content .tiptap .ProseMirror-gapcursor::after {
  content: '';
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 2px solid var(--color-accent, #3b82f6);
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.editor-content .tiptap .ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

/* Table wrapper - constrain width and clip overflow during resize */
.editor-content .tiptap .tableWrapper {
  position: relative;
  width: 100%;
  max-width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  contain: inline-size; /* Prevent table from expanding wrapper */
}

/* Clickable area above table */
.editor-content .tiptap .tableWrapper::before {
  content: '';
  position: absolute;
  top: -12px;
  left: 0;
  right: 0;
  height: 12px;
  cursor: text;
}

/* Clickable area below table */
.editor-content .tiptap .tableWrapper::after {
  content: '';
  position: absolute;
  bottom: -12px;
  left: 0;
  right: 0;
  height: 12px;
  cursor: text;
}
