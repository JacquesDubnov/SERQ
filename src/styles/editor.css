/**
 * TipTap Editor Styles
 *
 * Uses CSS variables from themes.css and presets system.
 * Variables prefixed with --color- come from color presets.
 */

/* Editor container */
.editor-content {
  min-height: 100%;
  width: 100%;
}

.editor-content .tiptap {
  outline: none;
}

/* Placeholder styling */
.editor-content .tiptap p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  float: left;
  color: var(--color-text-muted, #9ca3af);
  pointer-events: none;
  height: 0;
}

/* Prose defaults - uses preset variables */
.editor-content .tiptap {
  font-family: var(--font-body, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
  font-size: var(--font-size-base, 16px);
  line-height: var(--layout-line-spacing, var(--line-height-body, 1.6));
  letter-spacing: var(--letter-spacing-body, 0);
  color: var(--color-text-primary, #1a1a1a);
  text-align: var(--layout-text-align, left);
}

/* Headings
 *
 * Spacing uses CSS custom properties for future per-heading overrides:
 * - --h1-spacing-before, --h1-spacing-after (etc.) can override global spacing
 * - When not set, falls back to global --paragraph-spacing-before/after
 *
 * FUTURE: Per-heading custom spacing via heading context menu will set
 * these variables on individual heading elements via inline styles.
 */
.editor-content .tiptap h1,
.editor-content .tiptap h2,
.editor-content .tiptap h3,
.editor-content .tiptap h4,
.editor-content .tiptap h5,
.editor-content .tiptap h6 {
  font-family: var(--font-heading, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
  color: var(--color-text-primary, #1a1a1a);
  line-height: var(--line-height-heading, 1.2);
}

/* ===== HEADING STYLES =====
 * Consolidated heading styles with custom override support.
 * --hN-* variables are set dynamically when custom styles are applied via context menu.
 * Falls back to document defaults (--font-size-h1, etc.) then hardcoded defaults.
 */
.editor-content .tiptap h1 {
  font-size: var(--h1-font-size, var(--font-size-h1, 2.25rem));
  font-family: var(--h1-font-family, var(--font-heading));
  font-weight: var(--h1-font-weight, 700);
  font-style: var(--h1-font-style, normal);
  text-decoration: var(--h1-text-decoration, none);
  letter-spacing: var(--h1-letter-spacing, inherit);
  line-height: var(--h1-line-height, var(--line-height-heading, 1.2));
  color: var(--h1-color, var(--color-text-primary));
  background-color: var(--h1-background-color, transparent);
  caret-color: var(--h1-color, var(--color-text-primary, #1a1a1a));
  margin-top: var(--h1-spacing-before, var(--paragraph-spacing-before, 0));
  margin-bottom: var(--h1-spacing-after, var(--paragraph-spacing-after, 12px));
  position: relative;
}

.editor-content .tiptap h2 {
  font-size: var(--h2-font-size, var(--font-size-h2, 1.75rem));
  font-family: var(--h2-font-family, var(--font-heading));
  font-weight: var(--h2-font-weight, 600);
  font-style: var(--h2-font-style, normal);
  text-decoration: var(--h2-text-decoration, none);
  letter-spacing: var(--h2-letter-spacing, inherit);
  line-height: var(--h2-line-height, var(--line-height-heading, 1.2));
  color: var(--h2-color, var(--color-text-primary));
  background-color: var(--h2-background-color, transparent);
  caret-color: var(--h2-color, var(--color-text-primary, #1a1a1a));
  margin-top: var(--h2-spacing-before, var(--paragraph-spacing-before, 0));
  margin-bottom: var(--h2-spacing-after, var(--paragraph-spacing-after, 12px));
  position: relative;
}

.editor-content .tiptap h3 {
  font-size: var(--h3-font-size, var(--font-size-h3, 1.375rem));
  font-family: var(--h3-font-family, var(--font-heading));
  font-weight: var(--h3-font-weight, 600);
  font-style: var(--h3-font-style, normal);
  text-decoration: var(--h3-text-decoration, none);
  letter-spacing: var(--h3-letter-spacing, inherit);
  line-height: var(--h3-line-height, var(--line-height-heading, 1.2));
  color: var(--h3-color, var(--color-text-primary));
  background-color: var(--h3-background-color, transparent);
  caret-color: var(--h3-color, var(--color-text-primary, #1a1a1a));
  margin-top: var(--h3-spacing-before, var(--paragraph-spacing-before, 0));
  margin-bottom: var(--h3-spacing-after, var(--paragraph-spacing-after, 12px));
  position: relative;
}

.editor-content .tiptap h4 {
  font-size: var(--h4-font-size, var(--font-size-h4, 1.125rem));
  font-family: var(--h4-font-family, var(--font-heading));
  font-weight: var(--h4-font-weight, 600);
  font-style: var(--h4-font-style, normal);
  text-decoration: var(--h4-text-decoration, none);
  letter-spacing: var(--h4-letter-spacing, inherit);
  line-height: var(--h4-line-height, var(--line-height-heading, 1.2));
  color: var(--h4-color, var(--color-text-primary));
  background-color: var(--h4-background-color, transparent);
  caret-color: var(--h4-color, var(--color-text-primary, #1a1a1a));
  margin-top: var(--h4-spacing-before, var(--paragraph-spacing-before, 0));
  margin-bottom: var(--h4-spacing-after, var(--paragraph-spacing-after, 12px));
  position: relative;
}

.editor-content .tiptap h5,
.editor-content .tiptap h6 {
  font-size: var(--h5-font-size, 1rem);
  font-family: var(--h5-font-family, var(--font-heading));
  font-weight: var(--h5-font-weight, 600);
  font-style: var(--h5-font-style, normal);
  text-decoration: var(--h5-text-decoration, none);
  letter-spacing: var(--h5-letter-spacing, inherit);
  line-height: var(--h5-line-height, var(--line-height-heading, 1.2));
  color: var(--h5-color, var(--color-text-primary));
  background-color: var(--h5-background-color, transparent);
  caret-color: var(--h5-color, var(--color-text-primary, #1a1a1a));
  margin-top: var(--h5-spacing-before, var(--paragraph-spacing-before, 0));
  margin-bottom: var(--h5-spacing-after, var(--paragraph-spacing-after, 12px));
  position: relative;
}

/* ===== HEADING DIVIDERS =====
 * Dividing lines above/below headings via ::before and ::after pseudo-elements.
 * Controlled by CSS variables set from styleStore.headingCustomStyles[hN].divider
 *
 * Variables per heading (e.g., --h1-divider-*):
 *   --hN-divider-enabled: 0 or 1
 *   --hN-divider-position: below | above | both
 *   --hN-divider-distance: distance from text (e.g., 0.5em)
 *   --hN-divider-color: color value (default: currentColor)
 *   --hN-divider-thickness: line thickness (e.g., 1px)
 *   --hN-divider-double: 0 or 1 for double line
 *   --hN-divider-style: solid | dashed | dotted | wavy | zigzag | gradient
 */

/* Base divider styles - only show when enabled */
.editor-content .tiptap h1::before,
.editor-content .tiptap h1::after,
.editor-content .tiptap h2::before,
.editor-content .tiptap h2::after,
.editor-content .tiptap h3::before,
.editor-content .tiptap h3::after,
.editor-content .tiptap h4::before,
.editor-content .tiptap h4::after,
.editor-content .tiptap h5::before,
.editor-content .tiptap h5::after,
.editor-content .tiptap h6::before,
.editor-content .tiptap h6::after {
  content: '';
  display: none;
  width: 100%;
  height: 0;
  border: none;
}

/* H1 Divider - Below */
.editor-content .tiptap h1::after {
  display: var(--h1-divider-show-after, none);
  margin-top: var(--h1-divider-distance, 0.5em);
  border-bottom-width: var(--h1-divider-thickness, 1px);
  border-bottom-style: var(--h1-divider-style, solid);
  border-bottom-color: var(--h1-divider-color, currentColor);
}

/* H1 Divider - Above */
.editor-content .tiptap h1::before {
  display: var(--h1-divider-show-before, none);
  margin-bottom: var(--h1-divider-distance, 0.5em);
  border-bottom-width: var(--h1-divider-thickness, 1px);
  border-bottom-style: var(--h1-divider-style, solid);
  border-bottom-color: var(--h1-divider-color, currentColor);
}

/* H2 Divider - Below */
.editor-content .tiptap h2::after {
  display: var(--h2-divider-show-after, none);
  margin-top: var(--h2-divider-distance, 0.5em);
  border-bottom-width: var(--h2-divider-thickness, 1px);
  border-bottom-style: var(--h2-divider-style, solid);
  border-bottom-color: var(--h2-divider-color, currentColor);
}

/* H2 Divider - Above */
.editor-content .tiptap h2::before {
  display: var(--h2-divider-show-before, none);
  margin-bottom: var(--h2-divider-distance, 0.5em);
  border-bottom-width: var(--h2-divider-thickness, 1px);
  border-bottom-style: var(--h2-divider-style, solid);
  border-bottom-color: var(--h2-divider-color, currentColor);
}

/* H3 Divider - Below */
.editor-content .tiptap h3::after {
  display: var(--h3-divider-show-after, none);
  margin-top: var(--h3-divider-distance, 0.5em);
  border-bottom-width: var(--h3-divider-thickness, 1px);
  border-bottom-style: var(--h3-divider-style, solid);
  border-bottom-color: var(--h3-divider-color, currentColor);
}

/* H3 Divider - Above */
.editor-content .tiptap h3::before {
  display: var(--h3-divider-show-before, none);
  margin-bottom: var(--h3-divider-distance, 0.5em);
  border-bottom-width: var(--h3-divider-thickness, 1px);
  border-bottom-style: var(--h3-divider-style, solid);
  border-bottom-color: var(--h3-divider-color, currentColor);
}

/* H4 Divider */
.editor-content .tiptap h4::after {
  display: var(--h4-divider-show-after, none);
  margin-top: var(--h4-divider-distance, 0.5em);
  border-bottom-width: var(--h4-divider-thickness, 1px);
  border-bottom-style: var(--h4-divider-style, solid);
  border-bottom-color: var(--h4-divider-color, currentColor);
}

.editor-content .tiptap h4::before {
  display: var(--h4-divider-show-before, none);
  margin-bottom: var(--h4-divider-distance, 0.5em);
  border-bottom-width: var(--h4-divider-thickness, 1px);
  border-bottom-style: var(--h4-divider-style, solid);
  border-bottom-color: var(--h4-divider-color, currentColor);
}

/* H5 Divider */
.editor-content .tiptap h5::after {
  display: var(--h5-divider-show-after, none);
  margin-top: var(--h5-divider-distance, 0.5em);
  border-bottom-width: var(--h5-divider-thickness, 1px);
  border-bottom-style: var(--h5-divider-style, solid);
  border-bottom-color: var(--h5-divider-color, currentColor);
}

.editor-content .tiptap h5::before {
  display: var(--h5-divider-show-before, none);
  margin-bottom: var(--h5-divider-distance, 0.5em);
  border-bottom-width: var(--h5-divider-thickness, 1px);
  border-bottom-style: var(--h5-divider-style, solid);
  border-bottom-color: var(--h5-divider-color, currentColor);
}

/* H6 Divider */
.editor-content .tiptap h6::after {
  display: var(--h6-divider-show-after, none);
  margin-top: var(--h6-divider-distance, 0.5em);
  border-bottom-width: var(--h6-divider-thickness, 1px);
  border-bottom-style: var(--h6-divider-style, solid);
  border-bottom-color: var(--h6-divider-color, currentColor);
}

.editor-content .tiptap h6::before {
  display: var(--h6-divider-show-before, none);
  margin-bottom: var(--h6-divider-distance, 0.5em);
  border-bottom-width: var(--h6-divider-thickness, 1px);
  border-bottom-style: var(--h6-divider-style, solid);
  border-bottom-color: var(--h6-divider-color, currentColor);
}

/* Double line variant - uses border-style: double */
/* Note: For double lines, thickness should be at least 3px */

/* Wavy divider style - uses background pattern */
.editor-content .tiptap h1[data-divider-wavy]::after,
.editor-content .tiptap h1[data-divider-wavy]::before,
.editor-content .tiptap h2[data-divider-wavy]::after,
.editor-content .tiptap h2[data-divider-wavy]::before,
.editor-content .tiptap h3[data-divider-wavy]::after,
.editor-content .tiptap h3[data-divider-wavy]::before {
  border: none;
  height: var(--divider-thickness, 2px);
  background: repeating-linear-gradient(
    90deg,
    var(--divider-color, currentColor) 0,
    var(--divider-color, currentColor) 4px,
    transparent 4px,
    transparent 8px
  );
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='4'%3E%3Cpath d='M0 2 Q5 0 10 2 T20 2' stroke='black' fill='none' stroke-width='2'/%3E%3C/svg%3E");
  mask-repeat: repeat-x;
  mask-size: 20px 4px;
  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='4'%3E%3Cpath d='M0 2 Q5 0 10 2 T20 2' stroke='black' fill='none' stroke-width='2'/%3E%3C/svg%3E");
  -webkit-mask-repeat: repeat-x;
  -webkit-mask-size: 20px 4px;
}

/* Gradient divider style */
.editor-content .tiptap h1[data-divider-gradient]::after,
.editor-content .tiptap h1[data-divider-gradient]::before,
.editor-content .tiptap h2[data-divider-gradient]::after,
.editor-content .tiptap h2[data-divider-gradient]::before,
.editor-content .tiptap h3[data-divider-gradient]::after,
.editor-content .tiptap h3[data-divider-gradient]::before {
  border: none;
  height: var(--divider-thickness, 1px);
  background: linear-gradient(
    90deg,
    transparent,
    var(--divider-color, currentColor) 20%,
    var(--divider-color, currentColor) 80%,
    transparent
  );
}

/* Paragraphs - global spacing from style store */
.editor-content .tiptap p {
  margin-top: var(--paragraph-spacing-before, 0);
  margin-bottom: var(--paragraph-spacing-after, 12px);
  text-indent: var(--layout-paragraph-indent, 0);
}

/* First/last child margin handling for paragraphs and headings */
.editor-content .tiptap p:first-child,
.editor-content .tiptap h1:first-child,
.editor-content .tiptap h2:first-child,
.editor-content .tiptap h3:first-child,
.editor-content .tiptap h4:first-child,
.editor-content .tiptap h5:first-child,
.editor-content .tiptap h6:first-child {
  margin-top: 0;
}

.editor-content .tiptap p:last-child,
.editor-content .tiptap h1:last-child,
.editor-content .tiptap h2:last-child,
.editor-content .tiptap h3:last-child,
.editor-content .tiptap h4:last-child,
.editor-content .tiptap h5:last-child,
.editor-content .tiptap h6:last-child {
  margin-bottom: 0;
}

/* Lists */
.editor-content .tiptap ul,
.editor-content .tiptap ol {
  padding-left: var(--layout-list-indent, 1.5rem);
  margin-bottom: 1em;
}

.editor-content .tiptap li {
  margin-bottom: 0.25em;
}

.editor-content .tiptap li p {
  margin-bottom: 0.25em;
}

.editor-content .tiptap ul {
  list-style-type: disc;
}

.editor-content .tiptap ol {
  list-style-type: decimal;
}

/* Nested lists */
.editor-content .tiptap ul ul,
.editor-content .tiptap ol ul {
  list-style-type: circle;
}

.editor-content .tiptap ul ul ul,
.editor-content .tiptap ol ul ul {
  list-style-type: square;
}

/* Blockquote */
.editor-content .tiptap blockquote {
  border-left: 3px solid var(--color-blockquote-border, #d1d5db);
  padding-left: var(--layout-blockquote-indent, 1rem);
  margin: 1rem 0;
  color: var(--color-blockquote-text, #6b7280);
  font-style: italic;
}

/* Inline code */
.editor-content .tiptap code {
  background-color: var(--color-code-bg, #f3f4f6);
  color: var(--color-code-text, #1a1a1a);
  padding: 0.125rem 0.375rem;
  border-radius: 0.25rem;
  font-family: var(--font-mono, ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Monaco, monospace);
  font-size: 0.875em;
}

/* Code block */
.editor-content .tiptap pre {
  background-color: var(--color-code-bg, #1f2937);
  color: var(--color-code-text, #f9fafb);
  padding: 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  margin: 1rem 0;
  font-family: var(--font-mono, ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Monaco, monospace);
  font-size: 0.875rem;
  line-height: 1.5;
}

.editor-content .tiptap pre code {
  background: none;
  padding: 0;
  color: inherit;
  font-size: inherit;
}

/* Links */
.editor-content .tiptap a,
.editor-content .tiptap .editor-link {
  color: var(--color-link, #2563eb);
  text-decoration: underline;
  cursor: pointer;
}

.editor-content .tiptap a:hover,
.editor-content .tiptap .editor-link:hover {
  opacity: 0.8;
}

/* Horizontal rule */
.editor-content .tiptap hr {
  border: none;
  border-top: 1px solid var(--color-border, #e5e7eb);
  margin: 2rem 0;
}

/* Highlight */
.editor-content .tiptap mark {
  background-color: var(--color-highlight, #fef08a);
  padding: 0.125rem 0;
  border-radius: 0.125rem;
}

/* Subscript/Superscript */
.editor-content .tiptap sub {
  font-size: 0.75em;
  vertical-align: sub;
}

.editor-content .tiptap sup {
  font-size: 0.75em;
  vertical-align: super;
}

/* Text alignment */
.editor-content .tiptap [style*="text-align: left"] {
  text-align: left;
}

.editor-content .tiptap [style*="text-align: center"] {
  text-align: center;
}

.editor-content .tiptap [style*="text-align: right"] {
  text-align: right;
}

.editor-content .tiptap [style*="text-align: justify"] {
  text-align: justify;
}

/* Gapcursor styling */
.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
}

.ProseMirror-gapcursor:after {
  content: '';
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid var(--color-text-primary, #1a1a1a);
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

/* Selection styling */
.editor-content .tiptap ::selection {
  background-color: var(--color-selection, rgba(59, 130, 246, 0.3));
}

/* Multi-selection highlight (Cmd+drag for non-consecutive selections) */
.editor-content .tiptap .multi-selection-highlight {
  background-color: var(--color-selection, rgba(59, 130, 246, 0.3));
  border-radius: 2px;
}

/* Canvas & Wrapper Styles */
:root {
  --canvas-width-narrow: 600px;
  --canvas-width-normal: 720px;
  --canvas-width-wide: 900px;
  --canvas-width-full: 100%;
}

.canvas-container {
  /* NO scroll here - only the main viewport scrolls */
  overflow: visible;
  transition: max-width 0.2s ease;
}

.editor-wrapper {
  min-height: 100%;
  cursor: text;
}

.editor-wrapper .tiptap {
  cursor: auto;
}

/* Responsive adjustments */
@media (max-width: 640px) {
  .canvas-container {
    padding: 20px !important;
    border-radius: 0 !important;
  }

  .editor-content .tiptap h1 {
    font-size: 1.75rem;
  }

  .editor-content .tiptap h2 {
    font-size: 1.5rem;
  }

  .editor-content .tiptap h3 {
    font-size: 1.25rem;
  }
}

/* Zoom slider - thin track with small circle handle */
.zoom-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 100px;
  height: 2px;
  background: var(--color-border, #3f3f46);
  border-radius: 1px;
  outline: none;
  cursor: pointer;
}

.zoom-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 12px;
  height: 12px;
  background: var(--color-text-secondary, #a1a1aa);
  border-radius: 50%;
  cursor: pointer;
  transition: background 150ms ease;
}

.zoom-slider::-webkit-slider-thumb:hover {
  background: var(--color-text-primary, #f5f5f5);
}

.zoom-slider::-moz-range-thumb {
  width: 12px;
  height: 12px;
  background: var(--color-text-secondary, #a1a1aa);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: background 150ms ease;
}

.zoom-slider::-moz-range-thumb:hover {
  background: var(--color-text-primary, #f5f5f5);
}

.zoom-slider::-moz-range-track {
  height: 2px;
  background: var(--color-border, #3f3f46);
  border-radius: 1px;
}

/* Print styles */
@media print {
  .canvas-container {
    overflow: visible;
    box-shadow: none !important;
    border-radius: 0 !important;
    max-width: 100% !important;
  }

  .editor-content .tiptap {
    page-break-inside: auto;
  }

  .editor-content .tiptap h1,
  .editor-content .tiptap h2,
  .editor-content .tiptap h3 {
    page-break-after: avoid;
  }

  .editor-content .tiptap p {
    orphans: 3;
    widows: 3;
  }
}
