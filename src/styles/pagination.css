/**
 * TipTap Pages Extension Styles
 *
 * Styles for the TipTap Pro Pages extension.
 * Handles page appearance, gaps, dark mode, and print output.
 *
 * Key elements:
 * - [data-tiptap-pagination] - Main pagination container
 * - .tiptap-pagination-gap - Gap between pages (where pageBreakBackground applies)
 * - .tiptap-page-header / .tiptap-page-footer - Header/footer areas
 * - .tiptap-page-break - Page break indicators
 */

/* ============================================
   Gap Between Pages - Full-width visual break
   ============================================ */

/*
 * The gap element is contained within the pagination container (same width as pages).
 * To create a full-viewport-width gap, we use pseudo-elements that extend beyond.
 */

.tiptap-pagination-gap {
  position: relative;
  background: #f5f5f5 !important;
  background-color: #f5f5f5 !important;
}

/* Extend gap to full viewport width using pseudo-elements */
.tiptap-pagination-gap::before,
.tiptap-pagination-gap::after {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  width: 100vw;
  background: inherit;
  pointer-events: none;
}

.tiptap-pagination-gap::before {
  right: 100%;
}

.tiptap-pagination-gap::after {
  left: 100%;
}

/* Dark mode gap */
.dark .tiptap-pagination-gap,
.theme-dark .tiptap-pagination-gap,
[data-theme="dark"] .tiptap-pagination-gap {
  background: #262626 !important;
  background-color: #262626 !important;
  border-color: #262626 !important;
}

/* Allow overflow for pseudo-elements but clip at main content level */
[data-tiptap-pagination] {
  overflow: visible;
}

/* ============================================
   Page Elements - White/dark "paper" on top
   ============================================ */

/*
 * TipTap Pages sets background-color: #fff directly on .ProseMirror via
 * a dynamically generated unique class. We need to override this for dark mode.
 * The page "paper" elements have class .page (created via JavaScript).
 */

/* Override TipTap's hardcoded white background and border on ProseMirror */
.theme-dark .ProseMirror,
[data-theme="dark"] .ProseMirror {
  background-color: #1f1f1f !important;
  border-color: #1f1f1f !important;
}

/* Target page elements by .page class (TipTap's actual class name) */
[data-tiptap-pagination] .page {
  background: #ffffff !important;
  background-color: #ffffff !important;
}

.theme-dark [data-tiptap-pagination] .page,
[data-theme="dark"] [data-tiptap-pagination] .page {
  background: #1f1f1f !important;
  background-color: #1f1f1f !important;
}

/* Fallback: target direct children divs that aren't gaps/headers/footers */
[data-tiptap-pagination] > div:not(.tiptap-pagination-gap):not(.tiptap-page-header):not(.tiptap-page-footer):not(.page) {
  background: #ffffff !important;
  background-color: #ffffff !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

/* Dark mode for fallback selector */
.theme-dark [data-tiptap-pagination] > div:not(.tiptap-pagination-gap):not(.tiptap-page-header):not(.tiptap-page-footer):not(.page),
[data-theme="dark"] [data-tiptap-pagination] > div:not(.tiptap-pagination-gap):not(.tiptap-page-header):not(.tiptap-page-footer):not(.page) {
  background: #1f1f1f !important;
  background-color: #1f1f1f !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

/* ============================================
   Page Header and Footer
   ============================================ */

/*
 * TipTap uses hsl(var(--background)) for header/footer backgrounds.
 * We need to set this CSS variable to match our page color.
 */

/* Light mode - white page */
:root {
  --background: 0 0% 100%;
}

/* Dark mode - dark page */
.theme-dark,
[data-theme="dark"] {
  --background: 0 0% 12%;
}

.tiptap-page-header,
.tiptap-page-footer {
  color: #9ca3af;
  font-size: 12px;
}

.theme-dark .tiptap-page-header,
.theme-dark .tiptap-page-footer,
[data-theme="dark"] .tiptap-page-header,
[data-theme="dark"] .tiptap-page-footer {
  color: #9ca3af;
}

/* ============================================
   Virtual Cursor - Custom caret rendering
   ============================================ */

/*
 * prosemirror-virtual-cursor hides native caret and renders a decoration.
 * This prevents cursor stretching across page gaps.
 * Override the default red color to match theme text color.
 */

.ProseMirror-focused {
  --prosemirror-virtual-cursor-color: currentColor;
}

.dark .ProseMirror-focused,
.theme-dark .ProseMirror-focused,
[data-theme="dark"] .ProseMirror-focused {
  --prosemirror-virtual-cursor-color: #e5e5e5;
}

/* Light mode explicit override */
.theme-light .ProseMirror-focused,
[data-theme="light"] .ProseMirror-focused {
  --prosemirror-virtual-cursor-color: #171717;
}

/* Gap should not capture clicks */
.tiptap-pagination-gap {
  pointer-events: none;
  user-select: none;
}

/* ============================================
   Content Break Rules - Prevent awkward breaks
   ============================================ */

[data-tiptap-pagination] h1,
[data-tiptap-pagination] h2,
[data-tiptap-pagination] h3,
[data-tiptap-pagination] h4,
[data-tiptap-pagination] h5,
[data-tiptap-pagination] h6 {
  break-after: avoid;
  page-break-after: avoid;
}

[data-tiptap-pagination] img,
[data-tiptap-pagination] table,
[data-tiptap-pagination] pre,
[data-tiptap-pagination] blockquote,
[data-tiptap-pagination] figure {
  break-inside: avoid;
  page-break-inside: avoid;
}

[data-tiptap-pagination] p {
  orphans: 3;
  widows: 3;
}

/* ============================================
   Print Styles
   ============================================ */

@media print {
  [data-tiptap-pagination] > div {
    box-shadow: none !important;
    border: none !important;
    page-break-after: always;
  }

  [data-tiptap-pagination] > div:last-child {
    page-break-after: auto;
  }

  .tiptap-pagination-gap {
    display: none !important;
  }
}

@page {
  margin: 0.75in;
}

@page :first {
  margin-top: 1in;
}
